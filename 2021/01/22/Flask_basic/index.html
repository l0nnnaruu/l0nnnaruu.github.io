<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="第一章 安装virtualenv基本使用virtualenv 环境安装 pip install virtualenv &#x2F;pip3 install virtualenv 安装好后virtualenv --version 可以查看版本 初始化一个虚拟环境 virtualenv venv-name 进入虚拟环境 source venv-name&#x2F;bin&#x2F;activate 退出环境deactivate">
<meta property="og:type" content="article">
<meta property="og:title" content="狗书阅读笔记(1)">
<meta property="og:url" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/index.html">
<meta property="og:site_name" content="L0nm4r|Blog">
<meta property="og:description" content="第一章 安装virtualenv基本使用virtualenv 环境安装 pip install virtualenv &#x2F;pip3 install virtualenv 安装好后virtualenv --version 可以查看版本 初始化一个虚拟环境 virtualenv venv-name 进入虚拟环境 source venv-name&#x2F;bin&#x2F;activate 退出环境deactivate">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611120563925.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611123396878.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611123651901.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611125055547.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611125115144.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611126225191.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611127303938.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611131969170.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611214430430.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611214460940.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611217839671.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611218214155.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611219092580.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611223257517.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611223756150.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611223821115.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611223257517.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611295414659.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611295488079.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611297903445.png">
<meta property="og:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611300161723.png">
<meta property="article:published_time" content="2021-01-22T11:38:09.000Z">
<meta property="article:modified_time" content="2021-01-22T11:54:41.000Z">
<meta property="article:author" content="L0nm4r">
<meta property="article:tag" content="python">
<meta property="article:tag" content="flask">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://l0nnnaruu.github.io/2021/01/22/Flask_basic/1611120563925.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>狗书阅读笔记(1)</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <li><a href="/">首页</a></li><li><a href="/about/">关于</a></li><li><a href="/archives/">归档</a></li><li><a target="_blank" rel="noopener" href="https://github.com/L0nm4r">项目</a></li>
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/01/31/HTTP%20request%20smuggling/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2021/01/21/JWT/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">回到顶部</span>
      <span id="i-share" class="info" style="display:none;">分享</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&text=狗书阅读笔记(1)"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&title=狗书阅读笔记(1)"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&is_video=false&description=狗书阅读笔记(1)"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=狗书阅读笔记(1)&body=Check out this article: http://l0nnnaruu.github.io/2021/01/22/Flask_basic/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&title=狗书阅读笔记(1)"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&title=狗书阅读笔记(1)"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&title=狗书阅读笔记(1)"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&title=狗书阅读笔记(1)"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&name=狗书阅读笔记(1)&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">第一章 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#virtualenv%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.</span> <span class="toc-text">virtualenv基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%A6%E4%B8%AD%E4%BB%A3%E7%A0%81%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">书中代码使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">第二章 程序的基本结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.1.</span> <span class="toc-text">初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%92%8C%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.</span> <span class="toc-text">路由和视图函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">2.3.</span> <span class="toc-text">启动服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82-%E5%93%8D%E5%BA%94%E5%BE%AA%E7%8E%AF"><span class="toc-number">2.4.</span> <span class="toc-text">请求-响应循环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask%E6%89%A9%E5%B1%95"><span class="toc-number">2.5.</span> <span class="toc-text">Flask扩展</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E6%A8%A1%E6%9D%BF"><span class="toc-number">3.</span> <span class="toc-text">第三章 模板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Jinja2%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">3.1.</span> <span class="toc-text">Jinja2模板引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">3.1.1.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84"><span class="toc-number">3.1.2.</span> <span class="toc-text">控制结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF"><span class="toc-number">3.2.</span> <span class="toc-text">模板继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask-Bootstrap"><span class="toc-number">3.3.</span> <span class="toc-text">Flask-Bootstrap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">3.4.</span> <span class="toc-text">自定义错误页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#url-for-%E9%93%BE%E6%8E%A5"><span class="toc-number">3.5.</span> <span class="toc-text">url_for 链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="toc-number">3.6.</span> <span class="toc-text">静态文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask-Moment"><span class="toc-number">3.7.</span> <span class="toc-text">Flask-Moment</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-Web%E8%A1%A8%E5%8D%95"><span class="toc-number">4.</span> <span class="toc-text">第四章 Web表单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1CSRF"><span class="toc-number">4.1.</span> <span class="toc-text">防御CSRF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E7%B1%BB"><span class="toc-number">4.2.</span> <span class="toc-text">表单类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E5%A4%84%E7%90%86"><span class="toc-number">4.3.</span> <span class="toc-text">表单处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8url-for%E5%92%8Csession%E6%94%B9%E5%96%84%E4%BD%93%E9%AA%8C"><span class="toc-number">4.4.</span> <span class="toc-text">使用url_for和session改善体验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flash%E6%B6%88%E6%81%AF"><span class="toc-number">4.5.</span> <span class="toc-text">Flash消息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">5.</span> <span class="toc-text">第五章 数据库操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.1.</span> <span class="toc-text">模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB"><span class="toc-number">5.2.</span> <span class="toc-text">关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">5.3.</span> <span class="toc-text">数据库操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.4.</span> <span class="toc-text">在视图函数操作数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E6%88%90Python-shell"><span class="toc-number">5.5.</span> <span class="toc-text">集成Python shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB"><span class="toc-number">5.6.</span> <span class="toc-text">数据库迁移</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6"><span class="toc-number">6.</span> <span class="toc-text">第六章 电子邮件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-%E5%A4%A7%E5%9E%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">7.</span> <span class="toc-text">第七章 大型程序的结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9%E7%9A%84%E6%94%B9%E5%8A%A8"><span class="toc-number">7.1.</span> <span class="toc-text">配置选项的改动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E6%98%AF%E6%9C%80%E4%B8%BB%E8%A6%81%E7%9A%84app%E5%8C%85"><span class="toc-number">7.2.</span> <span class="toc-text">然后是最主要的app包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1-%E8%93%9D%E6%9C%AC"><span class="toc-number">7.3.</span> <span class="toc-text">路由-蓝本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC"><span class="toc-number">7.4.</span> <span class="toc-text">启动脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Other"><span class="toc-number">7.5.</span> <span class="toc-text">Other</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%BC%E5%BE%97%E6%B3%A8%E6%84%8F%E7%9A%84%E5%BC%95%E7%94%A8"><span class="toc-number">7.6.</span> <span class="toc-text">值得注意的引用</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        狗书阅读笔记(1)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">L0nm4r|Blog</span>
      </span>
      
    <div class="postdate">
        <time datetime="2021-01-22T11:38:09.000Z" itemprop="datePublished">2021-01-22</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/flask/" rel="tag">flask</a>, <a class="tag-link-link" href="/tags/python/" rel="tag">python</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="1611120563925.png" alt="1611120563925"></p>
<h2 id="第一章-安装"><a href="#第一章-安装" class="headerlink" title="第一章 安装"></a>第一章 安装</h2><h3 id="virtualenv基本使用"><a href="#virtualenv基本使用" class="headerlink" title="virtualenv基本使用"></a>virtualenv基本使用</h3><p>virtualenv 环境安装 <code>pip install virtualenv </code>/<code>pip3 install virtualenv</code></p>
<p>安装好后<code>virtualenv --version</code> 可以查看版本</p>
<p>初始化一个虚拟环境 <code>virtualenv venv-name</code></p>
<p>进入虚拟环境 <code>source venv-name/bin/activate</code></p>
<p>退出环境<code>deactivate</code></p>
<blockquote>
<p>Python 3.3 通过 venv 模块原生支持虚拟环境，命令为 pyvenv . pyvenv 可以替代 virtualenv </p>
<p>在 Python 3.3 中使用 pyvenv 命令创建的虚拟环境不包含 pip ，你需要进行手动安装。Python 3.4 改进了这一缺陷， pyvenv 完全可以代替 virtualenv </p>
<p>pyvenv 使用可以参考 : <a target="_blank" rel="noopener" href="https://www.daehub.com/archives/8635.html">https://www.daehub.com/archives/8635.html</a> 两个其实差不多</p>
</blockquote>
<h3 id="书中代码使用"><a href="#书中代码使用" class="headerlink" title="书中代码使用"></a>书中代码使用</h3><p>狗书代码地址 <a target="_blank" rel="noopener" href="https://github.com/miguelgrinberg/flasky.git">https://github.com/miguelgrinberg/flasky.git</a></p>
<p>可以git clone到本地 用git checkout切换分支,标签</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/miguelgrinberg/flasky.git</span><br><span class="line">cd flasky</span><br><span class="line">git checkout 1a</span><br></pre></td></tr></table></figure>

<h2 id="第二章-程序的基本结构"><a href="#第二章-程序的基本结构" class="headerlink" title="第二章 程序的基本结构"></a>第二章 程序的基本结构</h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>所有 Flask 程序都必须创建一个程序实例,程序实例是 Flask 类的对象，经常使用下述代码创建</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Flask 类的构造函数只有一个必须指定的参数，即程序主模块或包的名字。在大多数程序中，Python 的 __name__ 变量就是所需的值</p>
</blockquote>
<h3 id="路由和视图函数"><a href="#路由和视图函数" class="headerlink" title="路由和视图函数"></a>路由和视图函数</h3><p>在 Flask 程序中定义路由的最简便方式，就是使用程序实例提供的<code> app.route</code> 修饰器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Hello World!&lt;/h1&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>把 index() 函数注册为程序根地址的处理程序,在浏览器中访问 <a target="_blank" rel="noopener" href="http://www.example.com/">http://www.example.com</a> 后，会触发服务器执行 index() 函数</p>
<blockquote>
<p>这里是使用修饰器把函数注册为一个事件的处理程序</p>
</blockquote>
<p>像 index() 这样的函数称为视图函数（view function）, 视图函数返回的响应可以是包含HTML 的简单字符串，也可以是复杂的表单</p>
<p>下面的示例可以处理更复杂的请求,匹配类似 <code> http://www.facebook.com/&lt;your-name&gt;</code> 的地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user</span>(<span class="params">name</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Hello, %s!&lt;/h1&gt;&#x27;</span> % name</span><br></pre></td></tr></table></figure>

<p>路由中的动态部分默认使用字符串,也可以使用别的类型</p>
<p>如 <code> /user/&lt;int:id&gt;</code>只会匹配动态片段 id 为整数的 URL</p>
<blockquote>
<p>Flask 支持在路由中使用 int 、 float 和 path 类型</p>
<p>path 类型也是字符串，但不把斜线视作分隔符，而将其当作动态片段的一部分</p>
</blockquote>
<h3 id="启动服务器"><a href="#启动服务器" class="headerlink" title="启动服务器"></a>启动服务器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>__name__== &#39; __main__ &#39;</code>在这里确保直接执行这个脚本时才启动开发Web 服务器</p>
</blockquote>
<p>把 debug 参数设为 True =&gt; 启用调试模式</p>
<blockquote>
<p>Flask 提供的 Web 服务器不适合在生产环境中使用,需要搭配别的服务器组件使用</p>
</blockquote>
<h3 id="请求-响应循环"><a href="#请求-响应循环" class="headerlink" title="请求-响应循环"></a>请求-响应循环</h3><ul>
<li>程序和请求上下文</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    user_agent = request.headers.get(<span class="string">&#x27;User-Agent&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;p&gt;Your browser is %s&lt;/p&gt;&#x27;</span> % user_agent</span><br></pre></td></tr></table></figure>

<p>Flask 使用上下文临时把某些对象变为全局可访问,让特定的变量在一个线程中全局可访问，与此同时却不会干扰其他线程</p>
<p>在 Flask 中有两种上下文：程序上下文和请求上下文,上面的示例是请求上下文</p>
<p><img src="1611123396878.png" alt="1611123396878"></p>
<ul>
<li>请求调度</li>
</ul>
<p>程序收到客户端发来的请求时，要找到处理该请求的视图函数.为了完成这个任务，Flask会在程序的 URL 映射中查找请求的 URL</p>
<p>URL 映射是 URL 和视图函数之间的对应关系</p>
<p>Flask 使用<code> app.route</code> 修饰器或者非修饰器形式的 <code>app.add_url_rule() </code>生成映射</p>
<p>使用url_map查看映射</p>
<p><img src="1611123651901.png" alt="1611123651901"></p>
<blockquote>
<p><code> /static/&lt;filename&gt;</code> 路由是Flask 添加的特殊路由，用于访问静态文件</p>
</blockquote>
<ul>
<li>请求钩子</li>
</ul>
<p>请求钩子用于处理请求前后的一些工作</p>
<p>请求钩子使用修饰器实现,Flask 支持以下 4 种钩子</p>
<p>​    before_first_request :注册一个函数，在处理第一个请求之前运行。</p>
<p>​    before_request  ：注册一个函数，在每次请求之前运行。</p>
<p>​    after_request  ：注册一个函数，如果没有未处理的异常抛出，在每次请求之后运行。</p>
<p>​    teardown_request  ：注册一个函数，即使有未处理的异常抛出，也在每次请求之后运行。</p>
<ul>
<li><p>更丰富的响应</p>
<p>添加状态码</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Bad Request&lt;/h1&gt;&#x27;</span>, <span class="number">400</span></span><br></pre></td></tr></table></figure>

<p>​    返回cookie需要使用到<code>make_response</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> make_response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    response = make_response(<span class="string">&#x27;&lt;h1&gt;This document carries a cookie!&lt;/h1&gt;&#x27;</span>)</span><br><span class="line">    response.set_cookie(<span class="string">&#x27;answer&#x27;</span>, <span class="string">&#x27;42&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>​    重定向</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> redirect</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">	<span class="keyword">return</span> redirect(<span class="string">&#x27;http://www.example.com&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>​    处理错误</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> abort</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_user</span>(<span class="params"><span class="built_in">id</span></span>):</span></span><br><span class="line">    user = load_user(<span class="built_in">id</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">    	abort(<span class="number">404</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Hello, %s&lt;/h1&gt;&#x27;</span> % user.name</span><br></pre></td></tr></table></figure>

<h3 id="Flask扩展"><a href="#Flask扩展" class="headerlink" title="Flask扩展"></a>Flask扩展</h3><p>Flask 只有两个主要依赖：子系统Werkzeug和 模板系统 Jinja2, Werkzeug 和 Jinjia2 都是由 Flask 的核心开发者开发而成</p>
<p>Flask 并不原生支持数据库访问、Web 表单验证和用户认证等高级功能,这些功能以及其他大多数 Web 程序中需要的核心服务都以扩展的形式实现，然后再与核心包集成</p>
<p>所以Flask扩展很丰富</p>
<p>下面以Flask-Script来说明Flask扩展使用</p>
<blockquote>
<p>Flask-Script 是一个 Flask 扩展，为 Flask 程序添加了一个命令行解析器</p>
</blockquote>
<p>安装: <code>pip install flask-script</code></p>
<p>导入: <code>from flask_script import Manager</code></p>
<blockquote>
<p>from flask.ext.xxx 已经不再使用.改为 flask_xxx</p>
</blockquote>
<p>使用:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_script <span class="keyword">import</span> Manager</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">manager = Manager(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Hello World!&lt;/h1&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Hello, %s!&lt;/h1&gt;&#x27;</span> % name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    manager.run()</span><br></pre></td></tr></table></figure>

<p>效果就是加了一些参数</p>
<p><img src="1611125055547.png" alt="1611125055547"></p>
<p>运行<code>python hello.py runserver</code></p>
<p><img src="1611125115144.png" alt="1611125115144"></p>
<p>–host指定监听ip <code>python hello.py runserver --host 0.0.0.0</code></p>
<h2 id="第三章-模板"><a href="#第三章-模板" class="headerlink" title="第三章 模板"></a>第三章 模板</h2><h3 id="Jinja2模板引擎"><a href="#Jinja2模板引擎" class="headerlink" title="Jinja2模板引擎"></a>Jinja2模板引擎</h3><ul>
<li><p>默认情况下，Flask 在程序文件夹中的 templates 子文件夹中寻找模板</p>
<p>模板示例:</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">templates/index.html:</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">templates/user.html</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;&#123; name &#125;&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>渲染模板–<code>render_template</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;user.html&#x27;</span>, name=name)</span><br></pre></td></tr></table></figure>

<p> render_template 函数的第一个参数是模板的文件名, 随后的参数都是键值对，表示模板中变量对应的真实值。</p>
<p>在这段代码中，第二个模板收到一个名为 name 的变量.左边的“name”表示参数名，就是模板中使用的占位符；右边的“name”是当前作用域中的变量，表示同名参数的值</p>
<h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><p><code>&#123;&#123; name &#125;&#125; </code>结构表示一个变量, 它是一种特殊的占位符,告诉模板引擎这个位置的值从渲染模板时使用的数据中获取</p>
<ul>
<li>复杂变量使用示例:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;A value from a dictionary: &#123;&#123; mydict[&#x27;key&#x27;] &#125;&#125;.&lt;/p&gt; # 字典</span><br><span class="line">&lt;p&gt;A value from a list: &#123;&#123; mylist[3] &#125;&#125;.&lt;/p&gt; # 列表</span><br><span class="line">&lt;p&gt;A value from a list, with a variable index: &#123;&#123; mylist[myintvar] &#125;&#125;.&lt;/p&gt; # 列表,变量组合</span><br><span class="line">&lt;p&gt;A value <span class="keyword">from</span> an <span class="built_in">object</span><span class="string">&#x27;s method: &#123;&#123; myobj.somemethod() &#125;&#125;.&lt;/p&gt; # 对象</span></span><br></pre></td></tr></table></figure>

<ul>
<li>过滤器</li>
</ul>
<p>可以使用过滤器修改变量，过滤器名添加在变量名之后，中间使用竖线分隔</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello, &#123;&#123; name|capitalize &#125;&#125; # 以首字母大写形式显示变量 name 的值</span><br></pre></td></tr></table></figure>

<p>常用过滤器</p>
<p><img src="1611126225191.png" alt="1611126225191"></p>
<blockquote>
<p>默认情况下，出于安全考虑，Jinja2 会转义所有变量,对信任的值使用safe过滤器,可以显示HTML代码</p>
</blockquote>
<p>完整过滤器列表 <a target="_blank" rel="noopener" href="https://jinja.palletsprojects.com/en/2.11.x/templates/#builtin-filters">https://jinja.palletsprojects.com/en/2.11.x/templates/#builtin-filters</a></p>
<h4 id="控制结构"><a href="#控制结构" class="headerlink" title="控制结构"></a>控制结构</h4><p>条件控制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if user %&#125;</span><br><span class="line">    Hello, &#123;&#123; user &#125;&#125;!</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    Hello, Stranger!</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p>for循环</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">    &#123;% for comment in comments %&#125;</span><br><span class="line">        &lt;li&gt;&#123;&#123; comment &#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;&#x2F;ul&gt;</span><br></pre></td></tr></table></figure>

<p>宏</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% macro render_comment(comment) %&#125;</span><br><span class="line">    &lt;li&gt;&#123;&#123; comment &#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line">&#123;% endmacro %&#125;</span><br><span class="line"></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &#123;% for comment in comments %&#125;</span><br><span class="line">        &#123;&#123; render_comment(comment) &#125;&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;&#x2F;ul&gt;</span><br></pre></td></tr></table></figure>

<p>为了重复使用宏，我们可以将其保存在单独的文件中，然后在需要使用的模板中导入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% import &#39;macros.html&#39; as macros %&#125;</span><br><span class="line"></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &#123;% for comment in comments %&#125;</span><br><span class="line">        &#123;&#123; macros.render_comment(comment) &#125;&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;&#x2F;ul&gt;</span><br></pre></td></tr></table></figure>

<p>需要在多处重复使用的模板代码片段可以写入单独的文件，再包含在所有模板中，以避免重复</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include &#39;common.html&#39; %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h3><ul>
<li><p>基模板:  base.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&#123;% block head %&#125;</span><br><span class="line">    &lt;title&gt;&#123;% block title %&#125;&#123;% endblock %&#125; - My Application&lt;&#x2F;title&gt;</span><br><span class="line">    &#123;% endblock %&#125;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &#123;% block body %&#125;</span><br><span class="line">    &#123;% endblock %&#125;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>block 标签定义的元素可在衍生模板中修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125; # extends</span><br><span class="line">&#123;% block title %&#125;Index&#123;% endblock %&#125;</span><br><span class="line">&#123;% block head %&#125;</span><br><span class="line">    &#123;&#123; super() &#125;&#125; # 使用 super() 获取原来的内容(原模版此处非空)</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">    &lt;&#x2F;style&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block body %&#125;</span><br><span class="line">    &lt;h1&gt;Hello, World!&lt;&#x2F;h1&gt; </span><br><span class="line">&#123;% endblock </span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Flask-Bootstrap"><a href="#Flask-Bootstrap" class="headerlink" title="Flask-Bootstrap"></a>Flask-Bootstrap</h3><p>安装扩展 <code>pip install flask-bootstrap</code></p>
<p>扩展初始化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_bootstrap <span class="keyword">import</span> Bootstrap</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">bootstrap = Bootstrap(app)</span><br></pre></td></tr></table></figure>

<p>初始化 Flask-Bootstrap 之后，可以在程序中使用一个包含所有 Bootstrap 文件的基模板</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends <span class="string">&quot;bootstrap/base.html&quot;</span> %&#125;</span><br></pre></td></tr></table></figure>

<p>改写user.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;bootstrap&#x2F;base.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;Flasky&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block navbar %&#125;</span><br><span class="line">&lt;div class&#x3D;&quot;navbar navbar-inverse&quot; role&#x3D;&quot;navigation&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;navbar-header&quot;&gt;</span><br><span class="line">            &lt;button type&#x3D;&quot;button&quot; class&#x3D;&quot;navbar-toggle&quot;data-toggle&#x3D;&quot;collapse&quot; data-target&#x3D;&quot;.navbar-collapse&quot;&gt;</span><br><span class="line">                &lt;span class&#x3D;&quot;sr-only&quot;&gt;Toggle navigation&lt;&#x2F;span&gt;</span><br><span class="line">                &lt;span class&#x3D;&quot;icon-bar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">                &lt;span class&#x3D;&quot;icon-bar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">                &lt;span class&#x3D;&quot;icon-bar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">            &lt;&#x2F;button&gt;</span><br><span class="line">            &lt;a class&#x3D;&quot;navbar-brand&quot; href&#x3D;&quot;&#x2F;&quot;&gt;Flasky&lt;&#x2F;a&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;navbar-collapse collapse&quot;&gt;</span><br><span class="line">            &lt;ul class&#x3D;&quot;nav navbar-nav&quot;&gt;</span><br><span class="line">                &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;&quot;&gt;Home&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">            &lt;&#x2F;ul&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;page-header&quot;&gt;</span><br><span class="line">        &lt;h1&gt;Hello, &#123;&#123; name &#125;&#125;!&lt;&#x2F;h1&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>效果图</p>
<p><img src="1611127303938.png" alt="1611127303938"></p>
<blockquote>
<p>不过还是感觉直接写html更方便23333</p>
</blockquote>
<h3 id="自定义错误页面"><a href="#自定义错误页面" class="headerlink" title="自定义错误页面"></a>自定义错误页面</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>) </span><span class="comment"># 404，客户端请求未知页面或路由时显示</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span>(<span class="params">e</span>):</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>), <span class="number">404</span></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">500</span></span>) </span><span class="comment"># 500，有未处理的异常时显示</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">internal_server_error</span>(<span class="params">e</span>):</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;500.html&#x27;</span>), <span class="number">500</span></span><br></pre></td></tr></table></figure>

<h3 id="url-for-链接"><a href="#url-for-链接" class="headerlink" title="url_for 链接"></a>url_for 链接</h3><p><code> url_for()</code>:使用程序 URL 映射中保存的信息生成 URL</p>
<p>用法: <code>    url_for(&#39;index&#39;)   </code>=&gt;<code>/</code></p>
<p>生成绝对地址 <code>url_for(&#39;index&#39;, _external=True)</code> =&gt;<code> http://localhost:5000/</code></p>
<p><code>url_for(&#39;user&#39;, name=&#39;john&#39;, _external=True)</code>=&gt;<code> http://localhost:5000/user/john</code></p>
<p><code>url_for(&#39;index&#39;, page=2)</code>=&gt; <code>/?page=2</code></p>
<h3 id="静态文件"><a href="#静态文件" class="headerlink" title="静态文件"></a>静态文件</h3><p>图片、JavaScript 源码文件和 CSS等</p>
<p>调用<code>url_for(&#39;static&#39;, filename=&#39;css/styles.css&#39;, _external=True)</code>会得到<code>http://localhost:5000/static/css/styles.css</code></p>
<p>使用示例: </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% block head %&#125;</span><br><span class="line">&#123;&#123; <span class="built_in">super</span>() &#125;&#125;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;shortcut icon&quot;</span> href=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename = &#x27;favicon.ico&#x27;) &#125;&#125;&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;image/x-icon&quot;</span>&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;icon&quot;</span> href=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename = &#x27;favicon.ico&#x27;) &#125;&#125;&quot;</span><span class="built_in">type</span>=<span class="string">&quot;image/x-icon&quot;</span>&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Flask-Moment"><a href="#Flask-Moment" class="headerlink" title="Flask-Moment"></a>Flask-Moment</h3><p>集成 moment.js到jinja2的一个flask拓展</p>
<p>安装<code> pip install flask-moment</code></p>
<p>初始化:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_moment <span class="keyword">import</span> Moment</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">moment = Moment(app)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Flask-Moment 还依赖 jquery.js ,</p>
<p>Bootstrap 已经引入了 jquery.js，因此只需引入 moment.js 即可</p>
</blockquote>
<p>在基模板的 scripts 块中引入这个库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#templates&#x2F;base.html</span><br><span class="line">&#123;% block scripts %&#125;</span><br><span class="line">    &#123;&#123; super() &#125;&#125;</span><br><span class="line">    &#123;&#123; moment.include_moment() &#125;&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,current_time=datetime.utcnow())</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># templates&#x2F;index.html</span><br><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;Flasky&#123;% endblock %&#125;</span><br><span class="line">&#123;% block page_content %&#125;</span><br><span class="line">&lt;div class&#x3D;&quot;page-header&quot;&gt;</span><br><span class="line">    &lt;h1&gt;Hello World!&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;p&gt;The local date and time is &#123;&#123; moment(current_time).format(&#39;LLL&#39;) &#125;&#125;.&lt;&#x2F;p&gt;</span><br><span class="line">&lt;p&gt;That was &#123;&#123; moment(current_time).fromNow(refresh&#x3D;True) &#125;&#125;.&lt;&#x2F;p&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>format(‘LLL’) 根据客户端电脑中的时区和区域设置渲染日期和时间</p>
<p> fromNow() 渲染相对时间戳，而且会随着时间的推移自动刷新显示的时间</p>
<p>效果如图</p>
<p><img src="1611131969170.png" alt="1611131969170"></p>
<p>moment.js : <a target="_blank" rel="noopener" href="http://momentjs.com/docs/#/displaying/">http://momentjs.com/docs/#/displaying/</a></p>
<h2 id="第四章-Web表单"><a href="#第四章-Web表单" class="headerlink" title="第四章 Web表单"></a>第四章 Web表单</h2><blockquote>
<p>处理表单可以使用 Flask-WTF 扩展 <a target="_blank" rel="noopener" href="http://pythonhosted.org/Flask-WTF/">http://pythonhosted.org/Flask-WTF/</a></p>
<p>源自WTForms（<a target="_blank" rel="noopener" href="http://wtforms.simplecodes.com)/">http://wtforms.simplecodes.com）</a></p>
</blockquote>
<p>安装 <code>pip install flask-wtf</code></p>
<h3 id="防御CSRF"><a href="#防御CSRF" class="headerlink" title="防御CSRF"></a>防御CSRF</h3><p>Flask-WTF 使用secret密钥生成加密令牌，再用令牌验证请求中表单数据的真伪</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;hard to guess string&#x27;</span> <span class="comment"># 强度就取决于这个密钥</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个SECRET_KEY密钥是通用的密钥 </p>
<p>Flask伪造session里面也见过这个密钥~</p>
</blockquote>
<h3 id="表单类"><a href="#表单类" class="headerlink" title="表单类"></a>表单类</h3><p>使用 Flask-WTF 时，每个 Web 表单都由一个继承自 Form 的类表示</p>
<p>Form中可包含多个字段, 每个字段都用相应类型的字段对象表示</p>
<p>字段对象可附属一个或多个验证函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> Form <span class="comment"># Form 基类</span></span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, SubmitField <span class="comment"># 字段</span></span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> Required <span class="comment"># 验证函数</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameForm</span>(<span class="params">Form</span>):</span></span><br><span class="line">    name = StringField(<span class="string">&#x27;What is your name?&#x27;</span>, validators=[Required()]) <span class="comment"># validators验证函数列表</span></span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;Submit&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>WTForms支持的HTML标准字段:</p>
<p><img src="1611214430430.png" alt="1611214430430"></p>
<p>WTForms 内建的验证函数:</p>
<p><img src="1611214460940.png" alt="1611214460940"></p>
<p>将表单渲染为HTML</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">&#123;&#123; form.hidden_tag() &#125;&#125;</span><br><span class="line">&#123;&#123; form.name.label &#125;&#125; &#123;&#123; form.name(id=&#x27;my-text-field&#x27;) &#125;&#125; # 指定该字段id属性 id=&#x27;my-text-field&#x27;</span><br><span class="line">&#123;&#123; form.submit() &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>或者借助Flask-Bootstrap</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">import</span> <span class="string">&quot;bootstrap/wtf.html&quot;</span> <span class="keyword">as</span> wtf %&#125; <span class="comment"># wtf 辅助函数</span></span><br><span class="line">&#123;&#123; wtf.quick_form(form) &#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends <span class="string">&quot;base.html&quot;</span> %&#125;</span><br><span class="line">&#123;% <span class="keyword">import</span> <span class="string">&quot;bootstrap/wtf.html&quot;</span> <span class="keyword">as</span> wtf %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;Flasky&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block page_content %&#125;</span><br><span class="line">&lt;div class=&quot;page-header&quot;&gt;</span><br><span class="line">    &lt;h1&gt;Hello, &#123;% if name %&#125;&#123;&#123; name &#125;&#125;&#123;% else %&#125;Stranger&#123;% endif %&#125;!&lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">	&#123;&#123; wtf.quick_form(form) &#125;&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>然后在视图函数,实例化出一个NameForm,传给模板</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    name = <span class="literal">None</span></span><br><span class="line">    form = NameForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit(): <span class="comment"># 验证表单是否提交</span></span><br><span class="line">        name = form.name.data</span><br><span class="line">        form.name.data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, current_time=datetime.utcnow(), form=form, name=name)</span><br></pre></td></tr></table></figure>

<p>效果大概就是 输入lonmar</p>
<p><img src="1611217839671.png" alt="1611217839671"></p>
<h3 id="表单处理"><a href="#表单处理" class="headerlink" title="表单处理"></a>表单处理</h3><p>上面的代码就已经包含了这表单处理的功能</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    name = <span class="literal">None</span></span><br><span class="line">    form = NameForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit(): <span class="comment"># 验证表单是否提交 </span></span><br><span class="line">        name = form.name.data</span><br><span class="line">        form.name.data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, current_time=datetime.utcnow(), form=form, name=name)</span><br></pre></td></tr></table></figure>

<p>提交表单后，如果数据能被所有验证函数接受，那么 validate_on_submit() 方法的返回值为 True ，否则返回 False </p>
<blockquote>
<p>这个函数的返回值决定是重新渲染表单还是处理表单提交的数据</p>
</blockquote>
<h3 id="使用url-for和session改善体验"><a href="#使用url-for和session改善体验" class="headerlink" title="使用url_for和session改善体验"></a>使用url_for和session改善体验</h3><p>提交表单之后再刷新会这样,影响用户体验</p>
<p><img src="1611218214155.png" alt="1611218214155"></p>
<p>可以用下面代码改善</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, session, redirect, url_for</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    name = <span class="literal">None</span></span><br><span class="line">    form = NameForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        session[<span class="string">&#x27;name&#x27;</span>] = form.name.data</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, current_time=datetime.utcnow(), form=form, name=session.get(<span class="string">&#x27;name&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="Flash消息"><a href="#Flash消息" class="headerlink" title="Flash消息"></a>Flash消息</h3><p>直接看代码和效果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, session, redirect, url_for, flash</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># 路由</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    name = <span class="literal">None</span></span><br><span class="line">    form = NameForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        old_name = session.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> old_name <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> old_name != form.name.data:</span><br><span class="line">            flash(<span class="string">&#x27;Looks like you have changed your name!&#x27;</span>) <span class="comment"># flash</span></span><br><span class="line">        session[<span class="string">&#x27;name&#x27;</span>] = form.name.data</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, current_time=datetime.utcnow(), form=form, name=session.get(<span class="string">&#x27;name&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>然后相应的base.html中要写渲染Flash消息的模板,写在block content里面</p>
<p>模板中使用<code>get_flashed_messages()</code>获取 flash消息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;#  flash  #&#125;</span><br><span class="line">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">        &#123;% for message in get_flashed_messages() %&#125;</span><br><span class="line">            &lt;div class&#x3D;&quot;alert alert-info&quot;&gt;</span><br><span class="line">                &lt;button type&#x3D;&quot;button&quot; class&#x3D;&quot;close&quot; data-dismiss&#x3D;&quot;alert&quot;&gt;&amp;times;&lt;&#x2F;button&gt;</span><br><span class="line">                &#123;&#123; message &#125;&#125;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">	</span><br><span class="line">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">        &#123;% block page_content %&#125;&#123;% endblock %&#125;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>效果就是</p>
<p><img src="1611219092580.png" alt="1611219092580"></p>
<h2 id="第五章-数据库操作"><a href="#第五章-数据库操作" class="headerlink" title="第五章 数据库操作"></a>第五章 数据库操作</h2><p>主要是Flask-SQLAlchemy的使用 <a target="_blank" rel="noopener" href="http://pythonhosted.org/Flask-SQLAlchemy/">http://pythonhosted.org/Flask-SQLAlchemy/</a></p>
<p>这个 Flask 扩展包装了 SQLAlchemy（<a target="_blank" rel="noopener" href="http://www.sqlalchemy.org/%EF%BC%89%E6%A1%86%E6%9E%B6">http://www.sqlalchemy.org/）框架</a></p>
<p>安装 <code> pip install flask-sqlalchemy</code></p>
<p> Flask-SQLAlchemy支持多种数据库, 数据库使用 URL 指定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MySQL 			   mysql:&#x2F;&#x2F;username:password@hostname&#x2F;database</span><br><span class="line">Postgres 		   postgresql:&#x2F;&#x2F;username:password@hostname&#x2F;database</span><br><span class="line">SQLite(Unix) 	   sqlite:&#x2F;&#x2F;&#x2F;&#x2F;absolute&#x2F;path&#x2F;to&#x2F;database</span><br><span class="line">SQLite(Windows)    sqlite:&#x2F;&#x2F;&#x2F;c:&#x2F;absolute&#x2F;path&#x2F;to&#x2F;database</span><br></pre></td></tr></table></figure>

<blockquote>
<p>SQLite 数据库不需要使用服务器，因此不用指定 hostname、username 和password.</p>
<p>URL 中的 database 是硬盘上文件的文件名</p>
</blockquote>
<p>程序使用的数据库 URL 必须保存到 Flask 配置对象的 SQLALCHEMY_DATABASE_URI 键中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.config[&#39;SQLALCHEMY_DATABASE_URI&#39;] &#x3D; &#39;mysql:&#x2F;&#x2F;root:123456@localhost&#x2F;MysqlTest&#39;</span><br></pre></td></tr></table></figure>

<p>使用示例: 以 SQLite为例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy <span class="comment"># 导入</span></span><br><span class="line"></span><br><span class="line">basedir = os.path.abspath(os.path.dirname(__file__))</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] =<span class="string">&#x27;sqlite:///&#x27;</span> + os.path.join(basedir, <span class="string">&#x27;data.sqlite&#x27;</span>)</span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_TRACK_MODIFICATIONS&#x27;</span>] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">db = SQLAlchemy(app)</span><br></pre></td></tr></table></figure>

<p><code>app.config[&#39;SQLALCHEMY_TRACK_MODIFICATIONS&#39;] = True</code> =&gt; 每次请求结束后都会自动提交数据库中的变动</p>
<p><code>db </code>对象是 <code>SQLAlchemy </code>类的实例，表示程序使用的数据库</p>
<h3 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h3><p><img src="1611223257517.png" alt="1611223257517"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    __tablename__ = <span class="string">&#x27;roles&#x27;</span> <span class="comment"># 表名</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>) <span class="comment"># column </span></span><br><span class="line">    name = db.Column(db.String(<span class="number">64</span>), unique=<span class="literal">True</span>) <span class="comment"># 不允许重复</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># __repr__ 返回一个具有可读性的字符串表示模型</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;Role %r&gt;&#x27;</span> % self.name</span><br><span class="line">   		</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    __tablename__ = <span class="string">&#x27;users&#x27;</span> <span class="comment"># 表名</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>) <span class="comment"># primary_key+True 设置id为主键</span></span><br><span class="line">    username = db.Column(db.String(<span class="number">64</span>), unique=<span class="literal">True</span>, index=<span class="literal">True</span>)  <span class="comment"># unique=True 该值不允许重复</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;User %r&gt;&#x27;</span> % self.username</span><br></pre></td></tr></table></figure>

<p><code>__tablename__</code> : 类变量, 数据库中所使用的表名</p>
<blockquote>
<p>如果没有定义<code>__tablename__</code>，Flask-SQLAlchemy 会使用一个默认名字,但是可能不符合命名规范</p>
</blockquote>
<p><code> db.Column</code>: 用来实例化为列对象,可选参数如下:</p>
<p><img src="1611223756150.png" alt="1611223756150"></p>
<p>常使用的一些列选项</p>
<p><img src="1611223821115.png" alt="1611223821115"></p>
<blockquote>
<p>Flask-SQLAlchemy 要求每个模型都要定义主键 ，这一列经常命名为 id </p>
</blockquote>
<p><code> __repr()__</code> : 可用于调试, 测试</p>
<h3 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h3><p><img src="1611223257517.png" alt="1611223257517"></p>
<p>上面只是定义了两张表,但是两张表之间是有一对一关系的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    __tablename__ = <span class="string">&#x27;roles&#x27;</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">64</span>), unique=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;Role %r&gt;&#x27;</span> % self.name</span><br><span class="line">    </span><br><span class="line">    users = db.relationship(<span class="string">&#x27;User&#x27;</span>, backref=<span class="string">&#x27;role&#x27;</span>)  <span class="comment"># 在关系的另一个模型中添加反向引用</span></span><br><span class="line">   		</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    __tablename__ = <span class="string">&#x27;users&#x27;</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    username = db.Column(db.String(<span class="number">64</span>), unique=<span class="literal">True</span>, index=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;User %r&gt;&#x27;</span> % self.username</span><br><span class="line">    </span><br><span class="line">    role_id = db.Column(db.Integer, db.ForeignKey(<span class="string">&#x27;roles.id&#x27;</span>)) <span class="comment"># 外键 这列的值是 roles 表中行的 id 值</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个还不太懂=.=,等有时间翻一下官方文档 <a target="_blank" rel="noopener" href="https://www.osgeo.cn/sqlalchemy/">https://www.osgeo.cn/sqlalchemy/</a></p>
</blockquote>
<h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><ul>
<li><p>创建表</p>
<p>在python shell中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> hello <span class="keyword">import</span> db</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.create_all()</span><br></pre></td></tr></table></figure>

<p>会新建一个 data.sqlite 的数据库文件</p>
<p>如果数据库表已经存在于数据库中，那么 db.create_all()不会重新创建或者更新这个表,需要:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.drop_all()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.create_all()</span><br></pre></td></tr></table></figure>

<p>还可以使用Flask-Migrate进行数据库迁移(不会丢失数据)</p>
</li>
<li><p>插入数据</p>
<p>需要先实例化表对象,实例化的时候带着参数,id(主键)由Flask-SQLAlchemy统一管理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hello <span class="keyword">import</span> Role, User</span><br><span class="line">admin_role = Role(name=<span class="string">&#x27;Admin&#x27;</span>)</span><br><span class="line">mod_role = Role(name=<span class="string">&#x27;Moderator&#x27;</span>)</span><br><span class="line">user_role = Role(name=<span class="string">&#x27;User&#x27;</span>)</span><br><span class="line">user_john = User(username=<span class="string">&#x27;john&#x27;</span>, role=admin_role)</span><br><span class="line">user_susan = User(username=<span class="string">&#x27;susan&#x27;</span>, role=user_role)</span><br><span class="line">user_david = User(username=<span class="string">&#x27;david&#x27;</span>, role=user_role)</span><br></pre></td></tr></table></figure>

<p>通过数据库会话( db.session) 管理对数据库所做的改动</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.session.add(admin_role)</span><br><span class="line">db.session.add(mod_role)</span><br><span class="line">db.session.add(user_role)</span><br><span class="line">db.session.add(user_john)</span><br><span class="line">db.session.add(user_susan)</span><br><span class="line">db.session.add(user_david)</span><br></pre></td></tr></table></figure>

<p>或者简写为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.session.add_all([admin_role, mod_role, user_role,user_john, user_susan, user_david])</span><br></pre></td></tr></table></figure>

<p>调用 commit() 方法提交会话 =&gt; 把对象写入数据库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>数据库会话也称为事务</p>
</blockquote>
</li>
<li><p>修改数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">admin_role.name = <span class="string">&#x27;Administrator&#x27;</span></span><br><span class="line">db.session.add(admin_role)</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure></li>
<li><p>删除数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.session.delete(mod_role)</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure></li>
<li><p>查询数据</p>
<p>Flask-SQLAlchemy 为每个模型类都提供了 query 对象,可以通过这个对象的方法进行查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Role.query.<span class="built_in">all</span>() <span class="comment"># 查询表中所有数据</span></span><br><span class="line"><span class="comment"># [&lt;Role u&#x27;admin&#x27;&gt;, &lt;Role u&#x27;Moderator&#x27;&gt;, &lt;Role u&#x27;User&#x27;&gt;]</span></span><br><span class="line"></span><br><span class="line">User.query.filter_by(role=user_role).<span class="built_in">all</span>() <span class="comment"># filter_by()过滤器</span></span><br><span class="line"><span class="comment"># [&lt;User u&#x27;susan&#x27;&gt;, &lt;User u&#x27;david&#x27;&gt;]</span></span><br></pre></td></tr></table></figure>

<p>查看原生的sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;&gt;</span><span class="operator">&gt;</span> str(User.query.filter_by(role<span class="operator">=</span>user_role))</span><br><span class="line"><span class="string">&#x27;SELECT users.id AS users_id, users.username AS users_username, users.role_id AS users_role_id \nFROM users \nWHERE ? = users.role_id&#x27;</span></span><br></pre></td></tr></table></figure>

<p>退出shell后.再重新进入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hello <span class="keyword">import</span> Role</span><br><span class="line">user_role = Role.query.filter_by(name=<span class="string">&#x27;User&#x27;</span>).first()</span><br><span class="line"><span class="comment"># user_role直接就是一个对象了,不需要再实例化</span></span><br></pre></td></tr></table></figure>

<p>常见过滤器,完整的可以参考<a target="_blank" rel="noopener" href="http://docs.sqlalchemy.org/">http://docs.sqlalchemy.org</a></p>
<p><img src="1611295414659.png" alt="1611295414659"></p>
</li>
</ul>
<p>还有一些执行查询的方法</p>
<blockquote>
<p><code>Role.query.filter_by(name=&#39;User&#39;)</code></p>
<p>=&gt; <code> &lt;flask_sqlalchemy.BaseQuery object at 0x000000000338A848&gt;</code></p>
<p><code>Role.query.filter_by(name=&#39;User&#39;).all()</code></p>
<p>=&gt; <code>[&lt;Role u&#39;User&#39;&gt;]</code></p>
</blockquote>
<p><img src="1611295488079.png" alt="1611295488079"></p>
<h3 id="在视图函数操作数据库"><a href="#在视图函数操作数据库" class="headerlink" title="在视图函数操作数据库"></a>在视图函数操作数据库</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    form = NameForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        testUser = User.query.filter_by(username=form.name.data).first()</span><br><span class="line">        <span class="keyword">if</span> testUser <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            testUser = User(username=form.name.data)</span><br><span class="line">            db.session.add(testUser)</span><br><span class="line">            db.session.commit()</span><br><span class="line">            session[<span class="string">&#x27;known&#x27;</span>] = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            session[<span class="string">&#x27;known&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">            session[<span class="string">&#x27;name&#x27;</span>] = form.name.data</span><br><span class="line">            form.name.data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">                           current_time=datetime.utcnow(),</span><br><span class="line">                           form=form,</span><br><span class="line">                           name=session.get(<span class="string">&#x27;name&#x27;</span>),</span><br><span class="line">                           known=session.get(<span class="string">&#x27;known&#x27;</span>, <span class="literal">False</span>))</span><br></pre></td></tr></table></figure>

<h3 id="集成Python-shell"><a href="#集成Python-shell" class="headerlink" title="集成Python shell"></a>集成Python shell</h3><p>让 Flask-Script 的 shell 命令自动导入特定的对象,如db,Role等</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_script <span class="keyword">import</span> Shell, Manager</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">manager = Manager(app)</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_shell_context</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(app=app, db=db, User=User, Role=Role)</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    manager.add_command(<span class="string">&quot;shell&quot;</span>, Shell(make_context=make_shell_context))</span><br><span class="line">    manager.debug = <span class="literal">True</span></span><br><span class="line">    manager.run()</span><br></pre></td></tr></table></figure>

<p>然后python hello.py shell</p>
<p><img src="1611297903445.png" alt="1611297903445"></p>
<h3 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a>数据库迁移</h3><p>SQLAlchemy 的主力开发人员编写了一个迁移框架,Alembic(<a target="_blank" rel="noopener" href="https://alembic.readthedocs.org/en/latest/index.html">https://alembic.readthedocs.org/en/latest/index.html</a>)</p>
<p>Flask 程序还可使用 Flask-Migrate(<a target="_blank" rel="noopener" href="http://flask-migrate.readthedocs.org/en/latest/)%E6%89%A9%E5%B1%95">http://flask-migrate.readthedocs.org/en/latest/)扩展</a></p>
<p>这个扩展对 Alembic 做了轻量级包装，并集成到了 Flask-Script 中</p>
<p>安装 <code>pip install flask-migrate</code></p>
<p>使用:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate, MigrateCommand</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">migrate = Migrate(app, db)</span><br><span class="line">manager.add_command(<span class="string">&#x27;db&#x27;</span>, MigrateCommand)</span><br></pre></td></tr></table></figure>

<p>为了导出数据库迁移命令，Flask-Migrate 提供了一个 MigrateCommand 类，可附加到 Flask-Script 的 manager 对象上</p>
<p><code>python hello.py db init</code> 创建迁移仓库,这个命令会创建 migrations 文件夹，所有迁移脚本都存放其中</p>
<p><code>python hello.py db migrate -m &quot;initial migration&quot;</code> 创建迁移脚本</p>
<p><code>python hello.py db upgrade</code> 将迁移应用到数据库</p>
<blockquote>
<p>没搞懂什么原理,数据库模型做出更改时执行<code>python hello.py db upgrade</code>应该就行了</p>
</blockquote>
<h2 id="第六章-电子邮件"><a href="#第六章-电子邮件" class="headerlink" title="第六章 电子邮件"></a>第六章 电子邮件</h2><p>安装 <code>pip install flask-mail</code></p>
<p>使用和配置:</p>
<p>Flask-Mail SMTP服务器的配置</p>
<p><img src="1611300161723.png" alt="1611300161723"></p>
<p>书中只给了连接Gmail的SMTP服务的具体使用方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask_mail <span class="keyword">import</span> Mail</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">mail = Mail(app)</span><br><span class="line">app.config[<span class="string">&#x27;MAIL_SERVER&#x27;</span>] = <span class="string">&#x27;smtp.googlemail.com&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_PORT&#x27;</span>] = <span class="number">587</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_USE_TLS&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_USERNAME&#x27;</span>] = os.environ.get(<span class="string">&#x27;MAIL_USERNAME&#x27;</span>)</span><br><span class="line">app.config[<span class="string">&#x27;MAIL_PASSWORD&#x27;</span>] = os.environ.get(<span class="string">&#x27;MAIL_PASSWORD&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>然后在系统shell里面设置环境变量(防止信息泄露),只在当前命令行下有效</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># linux</span></span><br><span class="line">export MAIL_USERNAME=&lt;Gmail username&gt;</span><br><span class="line">export MAIL_PASSWORD=&lt;Gmail password&gt;</span><br><span class="line"><span class="comment"># Windows </span></span><br><span class="line"><span class="built_in">set</span> MAIL_USERNAME=&lt;Gmail username&gt;</span><br><span class="line"><span class="built_in">set</span> MAIL_PASSWORD=&lt;Gmail password&gt;</span><br></pre></td></tr></table></figure>

<p>QQmail SMTP服务使用: <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_28388339/article/details/87898940">https://blog.csdn.net/qq_28388339/article/details/87898940</a></p>
<p>qq mail使用: <code>MAIL_DEFAULT_SENDER/SENDER</code>和<code>MAIL_USERNAME</code>必须保持一致</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">from</span> flask_mail <span class="keyword">import</span> Mail, Message</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;MAIL_DEBUG&#x27;</span>] = <span class="literal">True</span>             <span class="comment"># 开启debug，便于调试看信息</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_SUPPRESS_SEND&#x27;</span>] = <span class="literal">False</span>    <span class="comment"># 发送邮件，为True则不发送</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_SERVER&#x27;</span>] = <span class="string">&#x27;smtp.qq.com&#x27;</span>   <span class="comment"># 邮箱服务器</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_PORT&#x27;</span>] = <span class="number">465</span>               <span class="comment"># 端口</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_USE_SSL&#x27;</span>] = <span class="literal">True</span>           <span class="comment"># 重要，qq邮箱需要使用SSL</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_USE_TLS&#x27;</span>] = <span class="literal">False</span>          <span class="comment"># 不需要使用TLS</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_USERNAME&#x27;</span>] = <span class="string">&#x27;xxxxxxxxx@qq.com&#x27;</span> <span class="comment"># qq Mail</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_PASSWORD&#x27;</span>] = <span class="string">&#x27;xxxxxxxxxxxxxxxxxx&#x27;</span> <span class="comment"># 授权码</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_DEFAULT_SENDER&#x27;</span>] = <span class="string">&#x27;xxxxxxxxx@qq.com&#x27;</span>  <span class="comment"># 填邮箱，默认发送者</span></span><br><span class="line">mail = Mail(app)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    msg = Message(subject=<span class="string">&#x27;Hello World&#x27;</span>,</span><br><span class="line">                  sender=<span class="string">&quot;xxxxxxxxx@qq.com&quot;</span>,  <span class="comment"># 需要使用默认发送者则不用填</span></span><br><span class="line">                  recipients=[<span class="string">&#x27;xxxxxxxxx@qq.com&#x27;</span>])</span><br><span class="line">    msg.body = <span class="string">&#x27;sended by flask-email&#x27;</span></span><br><span class="line">    msg.html = <span class="string">&#x27;&lt;b&gt;测试Flask发送邮件&lt;b&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> app.app_context(): </span><br><span class="line">        <span class="comment"># Flask-Mail 中的 send() 函数使用 current_app ，因此要在激活的程序上下文中执行</span></span><br><span class="line">        mail.send(msg)</span><br></pre></td></tr></table></figure>

<ul>
<li>异步发送电子邮件</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">from</span> flask_mail <span class="keyword">import</span> Mail, Message</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;MAIL_DEBUG&#x27;</span>] = <span class="literal">True</span>             <span class="comment"># 开启debug，便于调试看信息</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_SUPPRESS_SEND&#x27;</span>] = <span class="literal">False</span>    <span class="comment"># 发送邮件，为True则不发送</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_SERVER&#x27;</span>] = <span class="string">&#x27;smtp.qq.com&#x27;</span>   <span class="comment"># 邮箱服务器</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_PORT&#x27;</span>] = <span class="number">465</span>               <span class="comment"># 端口</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_USE_SSL&#x27;</span>] = <span class="literal">True</span>           <span class="comment"># 重要，qq邮箱需要使用SSL</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_USE_TLS&#x27;</span>] = <span class="literal">False</span>          <span class="comment"># 不需要使用TLS</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_USERNAME&#x27;</span>] = <span class="string">&#x27;xxxxxxxxx@qq.com&#x27;</span> <span class="comment"># qq Mail</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_PASSWORD&#x27;</span>] = <span class="string">&#x27;xxxxxxxxxxxxxxxxxx&#x27;</span> <span class="comment"># 授权码</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_DEFAULT_SENDER&#x27;</span>] = <span class="string">&#x27;xxxxxxxxx@qq.com&#x27;</span>  <span class="comment"># 填邮箱，默认发送者</span></span><br><span class="line">mail = Mail(app)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_async_email</span>(<span class="params">app, msg</span>):</span></span><br><span class="line">    <span class="keyword">with</span> app.app_context():</span><br><span class="line">        mail.send(msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    msg = Message(subject=<span class="string">&#x27;Hello World&#x27;</span>,</span><br><span class="line">                  sender=<span class="string">&quot;xxxxxxxxx@qq.com&quot;</span>,  <span class="comment"># 需要使用默认发送者则不用填</span></span><br><span class="line">                  recipients=[<span class="string">&#x27;xxxxxxxxx@qq.com&#x27;</span>])</span><br><span class="line">    msg.body = <span class="string">&#x27;sended by flask-email&#x27;</span></span><br><span class="line">    msg.html = <span class="string">&#x27;&lt;b&gt;测试Flask发送邮件&lt;b&gt;&#x27;</span></span><br><span class="line">    thr = Thread(target=send_async_email, args=[app, msg])</span><br><span class="line">    thr.start()</span><br></pre></td></tr></table></figure>

<h2 id="第七章-大型程序的结构"><a href="#第七章-大型程序的结构" class="headerlink" title="第七章 大型程序的结构"></a>第七章 大型程序的结构</h2><p>调整一下结构就成下面这样了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">├─app</span><br><span class="line">│  	│--email.py</span><br><span class="line">│  	│--models.py</span><br><span class="line">│  	│--__init__.py</span><br><span class="line">│  	├─main</span><br><span class="line">│  	│    |--errors.py</span><br><span class="line">│  	│    |--forms.py</span><br><span class="line">│  	│    |--views.py</span><br><span class="line">│  	│    |--__init__.py</span><br><span class="line">│  	├─static</span><br><span class="line">│  	│</span><br><span class="line">│  	└─templates</span><br><span class="line">│      	│--404.html</span><br><span class="line">│      	│--index.html</span><br><span class="line">|	    | ... 省略一些</span><br><span class="line">│      	└─mail</span><br><span class="line">│             |--new_user.html</span><br><span class="line">│             |--new_user.txt</span><br><span class="line">│--config.py</span><br><span class="line">│--manage.py</span><br><span class="line">├─tests</span><br><span class="line">│     |--test_basics.py</span><br><span class="line">│     |--__init__.py</span><br><span class="line">│--data-dev.sqlite</span><br><span class="line">│--data-test.sqlite</span><br><span class="line">│--data.sqlite</span><br><span class="line">│--requirements.txt</span><br><span class="line">│--tree.txt</span><br><span class="line">├─migrations</span><br><span class="line">├─venv</span><br><span class="line">└─.idea</span><br></pre></td></tr></table></figure>

<p>最主要的就是app文件夹,然后config.py是配置文件,manage.py是启动管理文件</p>
<p>tests文件夹里面是测试文件</p>
<p>然后还要数据库文件等等.</p>
<p>分析一下这个结构</p>
<h3 id="配置选项的改动"><a href="#配置选项的改动" class="headerlink" title="配置选项的改动"></a>配置选项的改动</h3><p>配置选项集成到了一个文件config.py, 下面是代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">basedir = os.path.abspath(os.path.dirname(__file__))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 层次结构的配置类</span></span><br><span class="line"><span class="comment"># 基类 Config 通用配置</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>:</span></span><br><span class="line">    SECRET_KEY = os.environ.get(<span class="string">&#x27;SECRET_KEY&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;hard to guess string&#x27;</span></span><br><span class="line">    SQLALCHEMY_COMMIT_ON_TEARDOWN = <span class="literal">True</span></span><br><span class="line">    FLASKY_MAIL_SUBJECT_PREFIX = <span class="string">&#x27;[Flasky]&#x27;</span></span><br><span class="line"></span><br><span class="line">    FLASKY_MAIL_SENDER = <span class="string">&#x27;xxxxxxxx@xx.com&#x27;</span></span><br><span class="line">    FLASKY_ADMIN = <span class="string">&#x27;xxxxxxx@xx.com&#x27;</span></span><br><span class="line"></span><br><span class="line">    MAIL_SERVER = <span class="string">&#x27;smtp.qq.com&#x27;</span></span><br><span class="line">    MAIL_PORT = <span class="number">465</span></span><br><span class="line">    MAIL_USE_SSL = <span class="literal">True</span></span><br><span class="line">    MAIL_USE_TLS = <span class="literal">False</span></span><br><span class="line">    MAIL_USERNAME = <span class="string">&#x27;xxxxxxxx@xx.com&#x27;</span></span><br><span class="line">    MAIL_PASSWORD = <span class="string">&#x27;xxxxxxxxxxxxxxxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_app</span>(<span class="params">app</span>):</span>  <span class="comment"># 参数是程序实例</span></span><br><span class="line">        <span class="keyword">pass</span>            <span class="comment"># 可以执行对当前环境的配置初始化</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开发环境配置</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DevelopmentConfig</span>(<span class="params">Config</span>):</span></span><br><span class="line">    DEBUG = <span class="literal">True</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = os.environ.get(<span class="string">&#x27;DEV_DATABASE_URL&#x27;</span>) <span class="keyword">or</span> \</span><br><span class="line">                <span class="string">&#x27;sqlite:///&#x27;</span> + os.path.join(basedir, <span class="string">&#x27;data-dev.sqlite&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试环境配置</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestingConfig</span>(<span class="params">Config</span>):</span></span><br><span class="line">    TESTING = <span class="literal">True</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = os.environ.get(<span class="string">&#x27;TEST_DATABASE_URL&#x27;</span>) <span class="keyword">or</span> \</span><br><span class="line">                <span class="string">&#x27;sqlite:///&#x27;</span> + os.path.join(basedir, <span class="string">&#x27;data-test.sqlite&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生产环境配置</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductionConfig</span>(<span class="params">Config</span>):</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = os.environ.get(<span class="string">&#x27;DATABASE_URL&#x27;</span>) <span class="keyword">or</span> \</span><br><span class="line">                <span class="string">&#x27;sqlite:///&#x27;</span> + os.path.join(basedir, <span class="string">&#x27;data.sqlite&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">config = &#123;</span><br><span class="line">    <span class="string">&#x27;development&#x27;</span>: DevelopmentConfig,</span><br><span class="line">    <span class="string">&#x27;testing&#x27;</span>: TestingConfig,</span><br><span class="line">    <span class="string">&#x27;production&#x27;</span>: ProductionConfig,</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: DevelopmentConfig</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    一种配置写成一种类,有基类Config,然后别的配置类安装需求由基类派生出来</p>
<p>​    值得注意的是配置基类中有一个init_app()方法.这个方法在app工厂里面用来初始化扩展</p>
<h3 id="然后是最主要的app包"><a href="#然后是最主要的app包" class="headerlink" title="然后是最主要的app包"></a>然后是最主要的app包</h3><p>里面集成了static静态文件, templates模板文件(里面有一个mail文件夹放着mail模板)</p>
<p>然后为了更改配置,使用工厂函数.在<code>app/__init.py__</code> 中定义.内容如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_bootstrap <span class="keyword">import</span> Bootstrap</span><br><span class="line"><span class="keyword">from</span> flask_mail <span class="keyword">import</span> Mail</span><br><span class="line"><span class="keyword">from</span> flask_moment <span class="keyword">import</span> Moment</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> config</span><br><span class="line"></span><br><span class="line">bootstrap = Bootstrap()</span><br><span class="line">mail = Mail()</span><br><span class="line">moment = Moment()</span><br><span class="line">db = SQLAlchemy()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_app</span>(<span class="params">config_name</span>):</span></span><br><span class="line">    app = Flask(__name__)</span><br><span class="line">    app.config.from_object(config[config_name]) <span class="comment"># 加载配置文件</span></span><br><span class="line">    config[config_name].init_app(app)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># init_app</span></span><br><span class="line">    bootstrap.init_app(app)</span><br><span class="line">    mail.init_app(app)</span><br><span class="line">    moment.init_app(app)</span><br><span class="line">    db.init_app(app)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 附加路由和自定义的错误页面</span></span><br><span class="line">    <span class="keyword">from</span> .main <span class="keyword">import</span> main <span class="keyword">as</span> main_blueprint</span><br><span class="line">    app.register_blueprint(main_blueprint)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> app  <span class="comment"># 工厂函数返回创建的程序示例</span></span><br></pre></td></tr></table></figure>

<p>在这里面集成和初始化Flask的扩展.返回一个实例化对象.</p>
<p>主要函数就是<code>create_app()</code> , 同时还要在里面注册蓝本,来导入路由等</p>
<blockquote>
<p>然而并没看懂哪里有优势了,更难懂了.其中部分代码还不是很理解.后面再看</p>
</blockquote>
<h3 id="路由-蓝本"><a href="#路由-蓝本" class="headerlink" title="路由-蓝本"></a>路由-蓝本</h3><p>然后在一个叫蓝本里面的东西定义路由之类的.需要在一个包里面.就是结构中的main文件夹</p>
<p>然后在 <code>app/main/__init__.py</code> 初始化这个蓝本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"><span class="comment"># 通过实例化一个 Blueprint 类对象创建蓝本</span></span><br><span class="line">main = Blueprint(<span class="string">&#x27;main&#x27;</span>, __name__)</span><br><span class="line"><span class="comment"># 两个参数 蓝本的名字和蓝本所在的包或模块</span></span><br><span class="line"><span class="comment"># 一定要在最后导入,否则可能循环导入</span></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views, errors <span class="comment"># 导入路由和错误处理的路由</span></span><br></pre></td></tr></table></figure>

<p>然后views.py 就是一些视图函数.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template, session, redirect, url_for, current_app</span><br><span class="line"><span class="comment"># . 是当前路径, ..就是上一级路径</span></span><br><span class="line"><span class="keyword">from</span> .. <span class="keyword">import</span> db <span class="comment"># 引入app/__init__下的数据库对象</span></span><br><span class="line"><span class="keyword">from</span> ..models <span class="keyword">import</span> User <span class="comment"># User类</span></span><br><span class="line"><span class="keyword">from</span> ..email <span class="keyword">import</span> send_email <span class="comment"># send_email函数</span></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> main <span class="comment"># 引入整个蓝本</span></span><br><span class="line"><span class="keyword">from</span> .forms <span class="keyword">import</span> NameForm <span class="comment"># 引入Form类</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># main.route</span></span><br><span class="line"><span class="meta">@main.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    form = NameForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        user = User.query.filter_by(username=form.name.data).first()</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            user = User(username=form.name.data)</span><br><span class="line">            db.session.add(user)</span><br><span class="line">            db.session.commit()</span><br><span class="line">            session[<span class="string">&#x27;known&#x27;</span>] = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> current_app.config[<span class="string">&#x27;FLASKY_ADMIN&#x27;</span>]:</span><br><span class="line">                send_email(current_app.config[<span class="string">&#x27;FLASKY_ADMIN&#x27;</span>], <span class="string">&#x27;New User&#x27;</span>,</span><br><span class="line">                           <span class="string">&#x27;mail/new_user&#x27;</span>, user=user)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            session[<span class="string">&#x27;known&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">        session[<span class="string">&#x27;name&#x27;</span>] = form.name.data</span><br><span class="line">		<span class="comment"># Flask 会为蓝本中的全部端点加上一个命名空间,命名空间就是蓝本的名字</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;.index&#x27;</span>))</span><br><span class="line">		<span class="comment">#  url_for(&#x27;main.index&#x27;)或者胜利main url_for(&#x27;.index&#x27;)</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">                           current_time=datetime.utcnow(),</span><br><span class="line">                           form=form, name=session.get(<span class="string">&#x27;name&#x27;</span>),</span><br><span class="line">                           known=session.get(<span class="string">&#x27;known&#x27;</span>, <span class="literal">False</span>))</span><br></pre></td></tr></table></figure>

<p>errors.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">#@main.app_errorhandler</span></span><br><span class="line"><span class="meta">@main.app_errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span>(<span class="params">e</span>):</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@main.app_errorhandler(<span class="params"><span class="number">500</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">internal_server_error</span>(<span class="params">e</span>):</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;500.html&#x27;</span>), <span class="number">500</span></span><br></pre></td></tr></table></figure>

<p>这里使用的是<code>@main.app_errorhandler</code>而不是 <code>@main.errorhandler</code></p>
<p><code> errorhandler</code>:只处理蓝本里面的错误</p>
<p><code>app_errorhandler</code>:处理全局错误</p>
<p>然后不知道forms.py为啥也在蓝本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, SubmitField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameForm</span>(<span class="params">FlaskForm</span>):</span></span><br><span class="line">    name = StringField(<span class="string">&#x27;What is your name?&#x27;</span>, validators=[DataRequired()])</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;Submit&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app, db</span><br><span class="line"><span class="keyword">from</span> app.models <span class="keyword">import</span> User, Role</span><br><span class="line"><span class="keyword">from</span> flask_script <span class="keyword">import</span> Manager, Shell</span><br><span class="line"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate, MigrateCommand</span><br><span class="line"></span><br><span class="line">app = create_app(os.getenv(<span class="string">&#x27;FLASK_CONFIG&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;default&#x27;</span>)</span><br><span class="line">manager = Manager(app)</span><br><span class="line">migrate = Migrate(app, db)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_shell_context</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(app=app, db=db, User=User, Role=Role)</span><br><span class="line"></span><br><span class="line">manager.add_command(<span class="string">&quot;shell&quot;</span>, Shell(make_context=make_shell_context))</span><br><span class="line">manager.add_command(<span class="string">&#x27;db&#x27;</span>, MigrateCommand)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    manager.run()</span><br></pre></td></tr></table></figure>

<h3 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h3><ul>
<li><p>requirements.txt可以用这条命令生成<code>pip freeze &gt;requirements.txt</code></p>
</li>
<li><p> <code>pip install -r requirements.txt</code></p>
</li>
<li><p>单元测试,书中给了如下的代码,讲解也很少</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> current_app</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app, db</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicsTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.app = create_app(<span class="string">&#x27;testing&#x27;</span>)</span><br><span class="line">        self.app_context = self.app.app_context()</span><br><span class="line">        self.app_context.push()</span><br><span class="line">        db.create_all()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        db.session.remove()</span><br><span class="line">        db.drop_all()</span><br><span class="line">        self.app_context.pop()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_app_exists</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertFalse(current_app <span class="keyword">is</span> <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_app_is_testing</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertTrue(current_app.config[<span class="string">&#x27;TESTING&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p>使用 unittest 包编写 <a target="_blank" rel="noopener" href="https://docs.python.org/2/library/unittest.html">https://docs.python.org/2/library/unittest.html</a></p>
<p> setUp() 和 tearDown() 方法分别在各测试前后运行</p>
<p>以 test_ 开头的函数都作为测试执行 </p>
<p>然后书中给了在manger.py里面编写测试函数的示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">test_names</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Run the unit tests.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">import</span> unittest</span><br><span class="line">    <span class="keyword">if</span> test_names:</span><br><span class="line">        tests = unittest.TestLoader().loadTestsFromNames(test_names)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tests = unittest.TestLoader().discover(<span class="string">&#x27;tests&#x27;</span>)</span><br><span class="line">    unittest.TextTestRunner(verbosity=<span class="number">2</span>).run(tests)</span><br></pre></td></tr></table></figure>

<h3 id="值得注意的引用"><a href="#值得注意的引用" class="headerlink" title="值得注意的引用"></a>值得注意的引用</h3><p>一些比较重要的各个文件直接的交叉引用</p>
<p>蓝本里面<code>app/main/__init__.py</code> 会引用views和errors</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views, errors</span><br></pre></td></tr></table></figure>

<p>views和errors又会引用蓝本<code>app/main/__init__.py</code> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> main</span><br></pre></td></tr></table></figure>

<p>然后就基本用到什么就导入什么,只是这种导入还不习惯.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> xxx</span><br><span class="line"><span class="keyword">from</span> .xxx <span class="keyword">import</span> xxx</span><br><span class="line"><span class="keyword">from</span> ..xxx <span class="keyword">import</span> xxx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>基础知识就到这</p>
<p>整个代码打包放在了GitHub. <a target="_blank" rel="noopener" href="https://github.com/L0nm4r/FlaskLearn">https://github.com/L0nm4r/FlaskLearn</a></p>
</blockquote>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/L0nm4r">项目</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">第一章 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#virtualenv%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.</span> <span class="toc-text">virtualenv基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%A6%E4%B8%AD%E4%BB%A3%E7%A0%81%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">书中代码使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">第二章 程序的基本结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.1.</span> <span class="toc-text">初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%92%8C%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.</span> <span class="toc-text">路由和视图函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">2.3.</span> <span class="toc-text">启动服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82-%E5%93%8D%E5%BA%94%E5%BE%AA%E7%8E%AF"><span class="toc-number">2.4.</span> <span class="toc-text">请求-响应循环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask%E6%89%A9%E5%B1%95"><span class="toc-number">2.5.</span> <span class="toc-text">Flask扩展</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E6%A8%A1%E6%9D%BF"><span class="toc-number">3.</span> <span class="toc-text">第三章 模板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Jinja2%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">3.1.</span> <span class="toc-text">Jinja2模板引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">3.1.1.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84"><span class="toc-number">3.1.2.</span> <span class="toc-text">控制结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF"><span class="toc-number">3.2.</span> <span class="toc-text">模板继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask-Bootstrap"><span class="toc-number">3.3.</span> <span class="toc-text">Flask-Bootstrap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">3.4.</span> <span class="toc-text">自定义错误页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#url-for-%E9%93%BE%E6%8E%A5"><span class="toc-number">3.5.</span> <span class="toc-text">url_for 链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="toc-number">3.6.</span> <span class="toc-text">静态文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask-Moment"><span class="toc-number">3.7.</span> <span class="toc-text">Flask-Moment</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-Web%E8%A1%A8%E5%8D%95"><span class="toc-number">4.</span> <span class="toc-text">第四章 Web表单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1CSRF"><span class="toc-number">4.1.</span> <span class="toc-text">防御CSRF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E7%B1%BB"><span class="toc-number">4.2.</span> <span class="toc-text">表单类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E5%A4%84%E7%90%86"><span class="toc-number">4.3.</span> <span class="toc-text">表单处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8url-for%E5%92%8Csession%E6%94%B9%E5%96%84%E4%BD%93%E9%AA%8C"><span class="toc-number">4.4.</span> <span class="toc-text">使用url_for和session改善体验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flash%E6%B6%88%E6%81%AF"><span class="toc-number">4.5.</span> <span class="toc-text">Flash消息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">5.</span> <span class="toc-text">第五章 数据库操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.1.</span> <span class="toc-text">模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB"><span class="toc-number">5.2.</span> <span class="toc-text">关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">5.3.</span> <span class="toc-text">数据库操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.4.</span> <span class="toc-text">在视图函数操作数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E6%88%90Python-shell"><span class="toc-number">5.5.</span> <span class="toc-text">集成Python shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB"><span class="toc-number">5.6.</span> <span class="toc-text">数据库迁移</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6"><span class="toc-number">6.</span> <span class="toc-text">第六章 电子邮件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-%E5%A4%A7%E5%9E%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">7.</span> <span class="toc-text">第七章 大型程序的结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9%E7%9A%84%E6%94%B9%E5%8A%A8"><span class="toc-number">7.1.</span> <span class="toc-text">配置选项的改动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E6%98%AF%E6%9C%80%E4%B8%BB%E8%A6%81%E7%9A%84app%E5%8C%85"><span class="toc-number">7.2.</span> <span class="toc-text">然后是最主要的app包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1-%E8%93%9D%E6%9C%AC"><span class="toc-number">7.3.</span> <span class="toc-text">路由-蓝本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC"><span class="toc-number">7.4.</span> <span class="toc-text">启动脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Other"><span class="toc-number">7.5.</span> <span class="toc-text">Other</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%BC%E5%BE%97%E6%B3%A8%E6%84%8F%E7%9A%84%E5%BC%95%E7%94%A8"><span class="toc-number">7.6.</span> <span class="toc-text">值得注意的引用</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&text=狗书阅读笔记(1)"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&title=狗书阅读笔记(1)"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&is_video=false&description=狗书阅读笔记(1)"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=狗书阅读笔记(1)&body=Check out this article: http://l0nnnaruu.github.io/2021/01/22/Flask_basic/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&title=狗书阅读笔记(1)"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&title=狗书阅读笔记(1)"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&title=狗书阅读笔记(1)"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&title=狗书阅读笔记(1)"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://l0nnnaruu.github.io/2021/01/22/Flask_basic/&name=狗书阅读笔记(1)&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> 目录</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> 顶部</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> 菜单</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    版权所有 &copy; 2021 L0nm4r
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <li><a href="/">首页</a></li><li><a href="/about/">关于</a></li><li><a href="/archives/">归档</a></li><li><a target="_blank" rel="noopener" href="https://github.com/L0nm4r">项目</a></li>
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<link rel="stylesheet" href="/lib/meslo-LG/styles.css">


<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">



<!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>


<script src="/js/main.js"></script>

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'lonmar-cn-1';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


